<!-- views/contractors.ejs -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ูุงุฑูุฑุฒ โ ุงูููุงูููู</title>
  <meta name="description" content="ุงุจุญุซ ุนู ููุงูููู ููุซูููู: ููุฑุจุงุกุ ูุถุฎุงุชุ ุทุงูุฉ ุดูุณูุฉุ ุจูุงุก ุฑูููุ ุชุดุฎูุต ูููุ ูุฃูุธูุฉ ุงูุฑู." />
  <!-- ุบููุฑ ุงููุณุงุฑุงุช ุญุณุจ ุฅุนุฏุงุฏ ุงูุณุชุงุชูู ูุฏูู -->
  <link rel="stylesheet" href="/Public/styles/contractorsstyle.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
</head>
<body>

  <!-- Navbar ูุน ุชูููุฒ ุตูุญุฉ ุงูููุงูููู -->
  <%- include('partials/navbar', { isAuth: (typeof isAuth!=='undefined'?isAuth:false), user: (typeof user!=='undefined'?user:null), active: 'contractors' }) %>

  <!-- ุตูุฏูู ุงูุชูุจููุงุช (ุชูุณุชุฎุฏูู ุงูุณูุฑุจุชุงุช ุฅู ููุฌุฏุช) -->
  <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- ุฒุฑ ูุงุชุณุงุจ ุนุงุฆู (ุงุฎุชูุงุฑู) -->
  <a class="fab-whatsapp"
     href="https://wa.me/21600000000?text=%D9%85%D8%B1%D8%AD%D8%A8%D8%A7%D9%8B%20%D9%81%D8%A7%D8%B1%D9%85%D8%B1%D8%B2%D8%8C%20%D8%A3%D8%AD%D8%AA%D8%A7%D8%AC%20%D9%85%D9%82%D8%A7%D9%88%D9%84"
     target="_blank" rel="noopener" aria-label="ุงูุฏุฑุฏุดุฉ ุนุจุฑ ูุงุชุณุงุจ">
    <span class="fab-whatsapp__icon" aria-hidden="true">ูุงุชุณุงุจ</span>
  </a>

  <!-- ========== ุณูุงูุฏุฑ ุฏุนุงุฆู (ุงุฎุชูุงุฑู) ========== -->
<!-- ุณูุงูุฏุฑ VIP ููููุงูููู ููุท -->
<% const vipContractors = Array.isArray(contractors) ? contractors.filter(c => c.subscriptionTier === 'VIP') : []; %>
<% if (vipContractors.length) { %>
<section id="gallery" class="section gallery" aria-labelledby="gallery-title">
  <div class="container">
    <h2 id="gallery-title" class="visually-hidden">ููุงูููู VIP</h2>

    <div class="swiper gallery-swiper" dir="rtl" aria-label="ููุงูููู VIP">
      <div class="swiper-wrapper">
        <% vipContractors.forEach(function(c){ 
             const img = (Array.isArray(c.photos) && c.photos[0]) || c.avatar || '/Public/assets/contractors/default.jpg';
             const services = Array.isArray(c.services) ? c.services.join('ุ ') : (c.services || '');
             const region = c.region || '';
        %>
          <div class="swiper-slide">
            <img src="<%= img %>" alt="ุตูุฑุฉ <%= c.name || 'ููุงูู' %>" loading="lazy" />
            <div class="slide-overlay">
              <h3 class="slide-title"><%= c.name || 'โ' %></h3>
              <p class="slide-sub">
                <%= services %><% if (services && region) { %> โ <% } %><%= region %>
              </p>
              <span class="badge" title="ุงูุชูููู" style="margin-top:1rem ;">โญ <%= (c.ratingAvg||0).toFixed(1) %> (<%= c.ratingCount||0 %>)</span><br>
              <a class="btn btn-primary" href="/contractor/<%= c._id %>">ุนุฑุถ ุงูููุงูู</a>
            </div>
          </div>
        <% }) %>
      </div>

      <div class="swiper-button-prev" aria-label="ุงูุณุงุจู"></div>
      <div class="swiper-button-next" aria-label="ุงูุชุงูู"></div>
      <div class="swiper-pagination"></div>
    </div>
  </div>
</section>
<% } %>


  <!-- ========== ููุชุฑุฉ ุงูููุงูููู ========== -->
<!-- ========== ููุชุฑุฉ ุงูููุงูููู ========== -->
<section id="filters" class="section filters" aria-labelledby="filters-title">
  <div class="container">
    <header class="section-header">
      <h2 id="filters-title">ููุชุฑุฉ ุงูููุงูููู</h2>
      <p class="muted">ุงุจุญุซ ุญุณุจ ุงูุชุฎุตุต ูุงูููุทูุฉ.</p>
    </header>

    <!-- ูุงุฌูุฉ ุจุญุซ ุชุฑุณู specialization & region ูู query string -->
    <form id="contractor-filters" class="filters-form" action="#list" method="get" novalidate>
      <div class="filters-grid">
        <!-- ุงูุชุฎุตุต ูู input ูุตูู -->
        <div class="field">
          <label class="label" for="specialization">ุงูุชุฎุตุต</label>
          <input
            id="specialization"
            name="specialization"
            type="text"
            placeholder="ูุซุงู: ููุฑุจุงุกุ ูุถุฎุงุชุ ุทุงูุฉ ุดูุณูุฉโฆ"
            value="<%= (typeof query!=='undefined' && query.specialization) ? query.specialization : '' %>"
          />
        </div>

        <!-- ุงูููุทูุฉ ูู input ูุตูู -->
        <div class="field">
          <label class="label" for="region">ุงูููุทูุฉ</label>
          <input
            id="region"
            name="region"
            type="text"
            placeholder="ูุซุงู: ุฑูู ุฏูุดูุ ุญูุตุ ุฏุฑุนุงโฆ"
            value="<%= (typeof query!=='undefined' && query.region) ? query.region : '' %>"
          />
        </div>

        <div class="field field--actions">
          <button class="btn btn-primary" type="submit">ุงุจุญุซ</button>
        </div>
      </div>
    </form>
  </div>
</section>


  <!-- ========== ูุงุฆูุฉ ุงูููุงูููู (VIP/Premium ุฃููุงู) ========== -->
  <!-- ========== ูุงุฆูุฉ ุงูููุงูููู (VIP/Premium ุฃููุงู) ========== -->
<section id="list" class="section list" aria-labelledby="list-title">
  <div class="container">
    <header class="section-header">
      <h2 id="list-title">ุงูููุงูููู ุงููุชุงุญูู</h2>
      <p class="muted">ูุธูุฑ ูุดุชุฑูู VIP ู Premium ุฃููุงู.</p>
    </header>

    <% const items = Array.isArray(contractors) ? contractors : []; %>

    <% if (!items.length) { %>
      <p class="muted">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุญุงููุงู.</p>
    <% } else { %>
      <!-- ุงูุดุจูุฉ: ูุนุฑุถ ุงููู ููุงุ ูุงูุณูุฑุจุช ุณููุณูููุง ุฅูู ุตูุญุงุช -->
      <div id="contractorsGrid" class="cards-grid" role="list" data-per-page="6">
        <% items.forEach(function(c){ %>
          <article class="contractor-card" role="listitem"
                   data-id="<%= c._id %>"
                   data-approved="<%= c.approved %>"
                   data-subscription="<%= c.subscriptionTier || 'Basic' %>"
                   data-specialization="<%= Array.isArray(c.services) ? c.services.join('ุ ') : (c.services || '') %>"
                   data-region="<%= c.region || '' %>">
            <a class="contractor-link" href="/contractor/<%= c._id %>" aria-label="ูุชุญ ุตูุญุฉ ุงูููุงูู: <%= c.name %>">
              <header class="contractor-head">
                <figure class="avatar">
                  <img src="<%= c.avatar || (Array.isArray(c.photos)&&c.photos[0]) || '/Public/assets/contractors/default.jpg' %>"
                       alt="ุตูุฑุฉ <%= c.name || 'โ' %>" loading="lazy" />
                </figure>
                <div class="head-info">
                  <h3 class="name"><%= c.name || 'โ' %></h3>
                  <p class="specialization"><%= Array.isArray(c.services) ? c.services.join('ุ ') : (c.services || 'โ') %></p>
                  <p class="region"><%= c.region || 'โ' %></p>
                </div>
                <span class="badge badge--tier"><%= c.subscriptionTier || 'Basic' %></span>
                <span class="badge" title="ุงูุชูููู">โญ <%= (c.ratingAvg||0).toFixed(1) %> (<%= c.ratingCount||0 %>)</span>
                <% if (c.featured) { %><span class="badge badge--featured">ููููุฒ</span><% } %>
              </header>
              <div class="contractor-body">
                <button class="btn btn-outline" type="button">ุตูุญุฉ ุงูููุงูู</button>
              </div>
            </a>
          </article>
        <% }) %>
      </div>

      <!-- ุงูุชุฑููู ุงูุฏุงุฎูู -->
      <nav id="contractorsPager" class="pager" aria-label="ุชุฑููู ุงููุชุงุฆุฌ" style="margin-top:1rem; display:grid; gap:.6rem; justify-content:center;">
        <div class="pager-controls" style="display:flex; gap:.35rem; flex-wrap:wrap; align-items:center; justify-content:center;">
          <button class="pager-prev btn btn-outline" type="button" aria-label="ุงูุณุงุจู">ุงูุณุงุจู</button>
          <div class="pager-pages" role="list" aria-label="ุฃุฑูุงู ุงูุตูุญุงุช"></div>
          <button class="pager-next btn btn-outline" type="button" aria-label="ุงูุชุงูู">ุงูุชุงูู</button>
        </div>
        <div class="pager-info muted" style="text-align:center; font-size:.92rem;"></div>
      </nav>
    <% } %>
  </div>
</section>

  <!-- ========== ุจุงูุฑ ุชุฑููุฌู ุณููู (ุงุฎุชูุงุฑู) ========== -->
 <%- include('partials/promo', { promoContractors }) %>

  <!-- Footer ูุจุณูุท -->
<!--

   ========================
       ุงูููุชุฑ
   ======================== -->
<footer class="farm-footer" dir="rtl" aria-labelledby="footer-title">
  <h2 id="footer-title" class="sr-only">ุชุฐููู ุงููููุน</h2>

  <div class="footer-top">
    <!-- ุงูุดุนุงุฑ ูุงููุตู ุงููุฎุชุตุฑ -->
    <div class="footer-brand">
      <div class="logo-mark" aria-hidden="true">๐ฟ</div>
      <div>
        <strong class="brand-name">ูุฒุฑุนุชู</strong>
        <p class="brand-desc">
          ููุตูุฉ ูุนุฑุถ ูุทูุจ ุงููุฒุงุฑุน (ุจูุน/ุฅูุฌุงุฑ) ูุฑุจุท ุงููุฒุงุฑุนูู ุจุงูููุงูููู ูุงูุฎุจุฑุงุก.
        </p>
      </div>
    </div>

    <!-- ุฑูุงุจุท ุณุฑูุนุฉ -->
    <nav class="footer-links" aria-label="ุฑูุงุจุท ุณุฑูุนุฉ">
      <div>
        <h3 class="footer-title">ุชุตูุญ</h3>
        <ul>
          <li><a href="/sale">ูุฒุงุฑุน ููุจูุน</a></li>
          <li><a href="/rent">ูุฒุงุฑุน ููุฅูุฌุงุฑ</a></li>
          <li><a href="/contractors">ุงูููุงูููู</a></li>
          <li><a href="/plans">ุงูุงุดุชุฑุงูุงุช</a></li>
        </ul>
      </div>
      <div>
        <h3 class="footer-title">ุงูุฏุนู</h3>
        <ul>
          <li><a href="/about">ูู ูุญู</a></li>
          <li><a href="/about#faq">ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</a></li>
          <li><a href="/about#privacy">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a></li>
          <li><a href="/about#terms">ุงูุดุฑูุท ูุงูุฃุญูุงู</a></li>
        </ul>
      </div>
      <div>
        <h3 class="footer-title">ุชูุงุตู</h3>
        <ul class="contact">
          <li><a href="mailto:info@farmers.example">info@farmers</a></li>
          <li><a href="tel:+963900000000">+963 900 000</a></li>
          <li><a href="https://wa.me/963900000000" target="_blank" rel="noopener">ูุงุชุณุงุจ ูุจุงุดุฑ</a></li>
        </ul>
      </div>
    </nav>
  </div>

  <div class="footer-bottom">
    <div class="social" aria-label="ุดุจูุงุช ุงุฌุชูุงุนูุฉ">
      <a class="s-link" href="#" aria-label="ุชููุชุฑ" title="ุชููุชุฑ" rel="noopener">
        <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M22 5.8c-.7.3-1.5.6-2.3.7.8-.5 1.4-1.3 1.7-2.2-.8.5-1.7.9-2.6 1.1A3.9 3.9 0 0 0 12 8.6c0 .3 0 .5.1.8A11 11 0 0 1 3 5.4a3.9 3.9 0 0 0 1.2 5.2c-.6 0-1.2-.2-1.7-.5v.1c0 1.9 1.3 3.6 3.2 4-.3.1-.7.2-1 .2-.2 0-.5 0-.7-.1.5 1.6 2 2.8 3.8 2.8A7.8 7.8 0 0 1 2 19.5c1.7 1.1 3.8 1.8 6 1.8 7.2 0 11.2-6 11.2-11.2v-.5c.8-.6 1.4-1.3 1.8-2.1z"/></svg>
      </a>
      <a class="s-link" href="#" aria-label="ููุณุจูู" title="ููุณุจูู" rel="noopener">
        <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M13 22v-8h3l1-4h-4V7c0-1.2.3-2 2-2h2V1h-3c-3 0-5 2-5 5v4H6v4h3v8h4z"/></svg>
      </a>
      <a class="s-link" href="#" aria-label="ููุชููุจ" title="ููุชููุจ" rel="noopener">
        <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M23.5 6.2a3 3 0 0 0-2.1-2.1C19.2 3.5 12 3.5 12 3.5s-7.2 0-9.4.6A3 3 0 0 0 .5 6.2 31 31 0 0 0 0 12a31 31 0 0 0 .5 5.8 3 3 0 0 0 2.1 2.1c2.2.6 9.4.6 9.4.6s7.2 0 9.4-.6a3 3 0 0 0 2.1-2.1A31 31 0 0 0 24 12a31 31 0 0 0-.5-5.8zM9.8 15.5V8.6l6.2 3.5-6.2 3.4z"/></svg>
      </a>
    </div>

    <p class="copyright">
      ยฉ <span id="year-placeholder">2025</span> ูุงุฑูุฑุฒ โ ุฌููุน ุงูุญููู ูุญููุธุฉ.
    </p>

    <div class="mini-links">
      <a href="/about">ุงูุฎุตูุตูุฉ</a>
      <span class="dot" aria-hidden="true">โข</span>
      <a href="/about">ุงูุดุฑูุท</a>
    </div>
  </div>
</footer>
  <!-- ุณูุฑุจุชุงุช -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="../Public/contractors.js"></script>
  <script>
(function(){
  const grid = document.getElementById('contractorsGrid');
  const pager = document.getElementById('contractorsPager');
  if(!grid || !pager) return;

  const cards = Array.from(grid.querySelectorAll('.contractor-card'));
  const perPage = parseInt(grid.dataset.perPage || '6', 10);
  let page = 1;
  const total = cards.length;
  const pages = Math.max(1, Math.ceil(total / perPage));

  const pagesWrap = pager.querySelector('.pager-pages');
  const prevBtn = pager.querySelector('.pager-prev');
  const nextBtn = pager.querySelector('.pager-next');
  const info    = pager.querySelector('.pager-info');

  function renderButtons(){
    pagesWrap.innerHTML = '';
    for(let i=1;i<=pages;i++){
      const b = document.createElement('button');
      b.type = 'button';
      b.className = 'btn ' + (i===page ? 'btn-primary' : 'btn-outline');
      b.textContent = i.toString();
      b.setAttribute('aria-label', 'ุตูุญุฉ ' + i);
      b.addEventListener('click', ()=>{ page=i; update(); });
      pagesWrap.appendChild(b);
    }
  }

  function update(){
    const start = (page-1)*perPage;
    const end   = start + perPage;

    cards.forEach((card, idx)=>{
      card.style.display = (idx>=start && idx<end) ? '' : 'none';
    });

    prevBtn.disabled = (page<=1);
    nextBtn.disabled = (page>=pages);
    info.textContent = `ุงูุตูุญุฉ ${page} ูู ${pages} โ ุนุฑุถ ${(Math.min(end, total))} ูู ${total}`;
    // ุชูุฑูุฑ ุฎููู ูููุฉ ุงููุงุฆูุฉ ุนูุฏ ุชุบููุฑ ุงูุตูุญุฉ
    if (document.location.hash !== '#list') document.location.hash = '#list';
    document.getElementById('list').scrollIntoView({ behavior:'smooth', block:'start' });
    // ุฅุนุงุฏุฉ ุฑุณู ุฃุฒุฑุงุฑ ุงูุตูุญุงุช ูุชุญุฏูุซ ุญุงูุฉ ุงูุฒุฑ ุงูููุนูู
    renderButtons();
  }

  prevBtn.addEventListener('click', ()=>{ if(page>1){ page--; update(); } });
  nextBtn.addEventListener('click', ()=>{ if(page<pages){ page++; update(); } });

  // ุชูุนูู ุฃููู
  renderButtons();
  update();
})();
</script>

</body>
</html>



