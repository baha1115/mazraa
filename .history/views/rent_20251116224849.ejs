<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farmers â€” Ù…Ø²Ø§Ø±Ø¹ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</title>
  <meta name="description" content="ØªØµÙØ­ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¥ÙŠØ¬Ø§Ø± â€” ØµÙÙ‘ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø©." />
  <link rel="stylesheet" href="/Public/styles/rentandfarmdetail.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
<link rel="dns-prefetch" href="https://res.cloudinary.com">

  <style>
    .vip-hero-slide{position:relative;min-height:360px;border-radius:16px;overflow:hidden;background:#f6faf6;}
    @media (min-width:1024px){.vip-hero-slide{min-height:520px;}}
    .vip-hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center;filter:brightness(.85);}
    .vip-hero-overlay{position:absolute;inset:0;background:linear-gradient(90deg, rgba(0,0,0,.35), rgba(0,0,0,.15) 40%, rgba(0,0,0,0) 70%);}
    .vip-hero-body{position:absolute;inset-inline:1.2rem;inset-block-end:1.1rem;color:#fff;display:grid;gap:.35rem;text-align:flex-start;}
    .vip-hero-title{font-size:clamp(20px,3vw,34px);margin:.25rem 0 0;}
    .vip-hero-meta{opacity:.95;font-size:clamp(14px,1.5vw,16px);}
    .vip-hero-cta{margin-top:.6rem;display:inline-block;padding:.5rem .9rem;border-radius:10px;background:#fff;color:#0f172a;text-decoration:none;font-weight:600;width:150px;text-align:center;}

    /* Ø´Ø§Ø±Ø© VIP ÙÙŠ Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ù€VIP */
    .vip-badge{position:absolute;top:12px;inset-inline-start:12px;background:#0f172a;color:#fff;border-radius:999px;font-size:.8rem;padding:.2rem .6rem;z-index:4;box-shadow:0 2px 8px rgba(0,0,0,.25)}

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø¯Ø§Ø®Ù„ Ø³ÙˆÙŠØ¨Ø± */
    .rent-swiper .swiper-slide{height:auto;}
    .farm-card{display:block;border:1px solid #e2e8f0;border-radius:14px;overflow:hidden;background:#fff}
    .farm-card img{width:100%;height:220px;object-fit:cover}
    .farm-body{padding:.8rem}
    .farm-title{margin:.2rem 0 .4rem;font-size:1.05rem}
    .farm-location,.farm-price{margin:0 0 .25rem;color:#475569}
    .btn.btn-outline{width:80%; display:inline-block;border:1px solid #0f172a;text-align: center; border-radius:10px;padding:.35rem .7rem;text-decoration:none}
    .badge{max-width: 60px; text-align: center; position:absolute;top:10px;inset-inline-start:10px;background:#0f172a;color:#fff;border-radius:999px;font-size:.75rem;padding:.15rem .5rem}
    .badge--video{text-align:center; inset-inline-start:auto;inset-inline-end:70px;background:#ef4444;width: 70px;}
.badge, .badge--video { z-index: 4;}

    /* ÙÙ„Ø§ØªØ± */
    .filter-dropdown summary{cursor:pointer;display:flex;align-items:center;gap:.5rem;font-weight:600;user-select:none;}
    .filter-dropdown summary::after{content:"â–¾";transition:.2s;font-size:.9rem;opacity:.9;}
    .filter-dropdown[open] summary::after{transform:rotate(180deg);}
    .filters-form{padding:.75rem 0 0;}
    .filters-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;}
    .field .label{display:block;margin:.2rem 0 .35rem}
    .field input,.field select{height:2.6rem;width:100%;padding:.75rem .9rem;border:1px solid #e2e8f0;border-radius:12px;}
    .field--actions{display:flex;align-items:flex-end}
    .btn.btn-primary{background:#0f172a;color:#fff;border:none;border-radius:10px;padding:.55rem 1rem}

    .empty{padding:2rem;text-align:center}
    /* Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø®Ø·Ø· */
.badge--Basic   { background:#64748b; }   /* Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø²Ø±Ù‘Ù‚ */
.badge--Premium { background:#0ea5e9;max-width: 80px; }   /* Ø³Ù…Ø§ÙˆÙŠ */
.badge--VIP     { background:#0f172a; }   /* ÙƒØ­Ù„ÙŠ */

.meta-views{
  display:inline-block;
  margin-top:.25rem;
  color:#475569;
  font-size:.9rem;
}
/* Ø­Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø²ÙŠØ¯ */
.more-fields[hidden] { display: none; }
.btn.btn-outline{border:1px solid #0f172a;border-radius:10px;padding:.55rem 1rem;background:#fff;color:#0f172a}
.vip-swiper .swiper-slide{ height:auto; }
/* ===== ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‡ÙŠØ±Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ Ù…Ø³ØªÙ‚Ù„ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„ØµÙˆØ±Ø©/Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ===== */
@media (max-width:640px){
  /* Ø­ÙˆÙ‘Ù„ ÙƒØªÙ„Ø© Ø§Ù„Ù‡ÙŠØ±Ùˆ Ø¥Ù„Ù‰ Grid Ø¨Ø¹Ù…ÙˆØ¯ÙŠÙ†: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (Ù…Ø±Ù†) + Ø£Ø²Ø±Ø§Ø± (Ø«Ø§Ø¨Øª) */
  .hero-top{
    display: grid;
    grid-template-columns: 1fr 140px;                /* Ø¹Ø¯Ù‘Ù„ 140px Ø¥Ù„Ù‰ 160â€“180 Ø­Ø³Ø¨ Ø°ÙˆÙ‚Ùƒ */
    grid-template-areas:
      "avatar actions"
      "name   actions"
      "spec   actions"
      "region actions"
      "rating actions"
      "stats  stats";
    align-items: center;
    column-gap: .75rem;
    row-gap: .25rem;
    text-align: start;                                /* Ø£Ø¹Ø¯ Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ Ù„Ù„ÙŠÙ…ÙŠÙ† (RTL) */
  }

  /* Ø¹Ø±Ù‘Ù Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø´Ø¨ÙƒØ© */
  .avatar--lg{ grid-area: avatar; justify-self: start; }
  .hero-copy{ display: contents; }                    /* ÙŠÙ…Ø±Ù‘Ø± Ø£Ø¨Ù†Ø§Ø¡ hero-copy Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù„Ù„Ø´Ø¨ÙƒØ© */
  .hero-copy .name{ grid-area: name; }
  .hero-copy .specialization{ grid-area: spec; }
  .hero-copy .region{ grid-area: region; }
  .hero-rating{ grid-area: rating; justify-content: flex-start; }
  .stats{ grid-area: stats; align-items: flex-start !important; }

  /* Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
  .hero-actions{
    grid-area: actions;
    display: flex;
    flex-direction: column;
    gap: .5rem;
    align-self: start;
  }
  .hero-actions .btn{ width: 100%; }
}
/* ===== Rent cards Â· polished (two-up mobile) ===== */

/* Ø¨Ø·Ø§Ù‚Ø© Ø£Ù†Ø¸Ù Ø¨Ø¸Ù„ ÙˆØ§Ù†ØªÙ‚Ø§Ù„ Ø®ÙÙŠÙ */
.farm-card{
  border:1px solid #e5e7eb; border-radius:14px; background:#fff; overflow:hidden;
  box-shadow:0 2px 10px rgba(2,6,23,.05);
  transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}
.farm-card:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(2,6,23,.08); border-color:#e2e8f0; }

/* ØµÙˆØ±Ø© Ø¨Ù†Ø³Ø¨Ø© 4:3 Ø¨Ø¯Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
.farm-media{ position:relative; aspect-ratio: 4 / 3; background:#f5f7f8; }
.farm-card img{ width:100% !important; height:100% !important; object-fit:cover !important; display:block; }

/* Ø¨Ø§Ø¯Ø¬Ø§Øª Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
.badge{
  position:absolute; inset-inline-start:10px; top:10px; z-index:4;
  display:inline-flex; align-items:center; gap:6px;
  padding:.18rem .55rem; border-radius:999px; font-size:.72rem; font-weight:800; letter-spacing:.2px;
  box-shadow:0 4px 14px rgba(0,0,0,.12);
}
.badge--video{ inset-inline-start:auto; inset-inline-end:10px; background:#ef4444; color:#fff; }
.badge--Basic{ display:none; } /* Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø´Ø§Ø±Ø© Basic */
.badge--Premium{ background:#0ea5e9; color:#fff; }
.badge--VIP{ background:#0f172a; color:#fff; }

/* Ø¬Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø´Ø¨ÙƒØ© Ø¨Ø³ÙŠØ·Ø© */
.farm-body{ display:grid; row-gap:.45rem; padding:.7rem .75rem; }
.farm-title{
  margin:0; font-size:1rem; font-weight:900;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; min-height:2.6em;
}
.farm-location{ margin:0; color:#64748b; font-size:.9rem; }
.farm-price{ margin:0; font-weight:900; letter-spacing:.2px; }
.meta-views{ margin-inline-start:auto; font-size:.85rem; color:#475569 !important; }

/* Ø²Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¨ÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø±Ø¶ */
.farm-body .btn.btn-outline{
  width:100%; text-align:center; border:1px solid #0f172a; color:#0f172a;
  border-radius:10px; padding:.48rem .85rem; font-weight:700;
}

/* Ø³Ù„Ø§ÙŠØ¯Ø§Øª Ø¨Ø§Ø±ØªÙØ§Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
.rent-swiper .swiper-slide{ height:auto; }

/* ===== Mobile fine-tuning ===== */
@media (max-width:640px){
  .farm-body{ padding:.6rem .6rem; row-gap:.4rem; }
  .farm-title{ font-size:.95rem; min-height:2.4em; }
  .farm-location{ font-size:.84rem; }
  .farm-price{ font-size:.9rem; }
  .farm-body .btn.btn-outline{ padding:.42rem .75rem; font-size:.86rem; }
  .badge{ font-size:.68rem; padding:.15rem .5rem; }
}
/* ===== Filters Â· compact on phones ===== */
@media (max-width:640px){
  /* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
  #filters .filter-dropdown summary{
    font-size: .95rem !important;
    padding: .45rem 0 !important;
  }
  #filters .filters-form{
    padding: .5rem 0 0 !important;
  }

  /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ù‚ÙˆÙ„: Ø¹Ù…ÙˆØ¯Ø§Ù† ØµØºÙŠØ±Ø§Ù† Ø¨Ø¯Ù„ Ø¨Ø·Ø§Ù‚Ø§Øª ÙƒØ¨ÙŠØ±Ø© */
  #filters .filters-grid{
    grid-template-columns: repeat(2, minmax(140px, 1fr)) !important; /* ÙƒØ§Ù† auto-fit 200px */
    gap: 8px !important;                                              /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª */
  }

  /* Ø§Ù„Ø­Ù‚Ù„ Ù†ÙØ³Ù‡ Ø£ØµØºØ± */
  #filters .field .label{
    margin: .1rem 0 .25rem !important;
    font-size: .85rem !important;
  }
  #filters .field input,
  #filters .field select{
    height: 2.1rem !important;                 /* ÙƒØ§Ù† ~2.6rem */
    padding: .4rem .6rem !important;
    font-size: .88rem !important;
    border-radius: 10px !important;
  }

  /* Ø²Ø± "Ù…Ø²ÙŠØ¯" Ù…Ø¶ØºÙˆØ· */
  #filters #toggle-more.btn.btn-outline{
    padding: .35rem .6rem !important;
    font-size: .86rem !important;
    border-radius: 10px !important;
    width: 100%;
  }

  /* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø¹Ù†Ø¯ ÙØªØ­ "Ù…Ø²ÙŠØ¯") Ø¨Ù†ÙØ³ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØµØºÙ‘Ø± */
  #filters #more-filters.filters-grid{
    grid-template-columns: repeat(2, minmax(140px,1fr)) !important;
    gap: 8px !important;
  }

  /* Ø²Ø± "ØªØ·Ø¨ÙŠÙ‚" Ø£ØµØºØ± ÙˆÙŠØªÙ…Ø§Ø´Ù‰ Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¶ */
  #filters .field--actions .btn.btn-primary{
    padding: .45rem .9rem !important;
    font-size: .9rem !important;
    border-radius: 10px !important;
  }
}
/* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙÙ„Ø§ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙÙ‚Ø· */
@media (max-width:640px){
  /* Ø£Ø®ÙÙ Ø¹Ù†ÙˆØ§Ù† "ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬" */
  #filters .filter-dropdown > summary{
    display: none !important;
  }
  /* Ø£Ø®ÙÙ Ø²Ø± "Ù…Ø²ÙŠØ¯" */
  #filters #toggle-more{
    display: none !important;
  }
  /* Ø£Ø®ÙÙ Ø²Ø± "ØªØ·Ø¨ÙŠÙ‚" */
  #filters .field--actions{
    display: none !important;
  }
  /* Ø¶Ø¨Ø· Ù‡ÙˆØ§Ù…Ø´ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø®ÙØ§Ø¡ */
  #filters .filters-form{ padding-top: 0 !important; }
  #filters .filters-grid{ margin-top: 0 !important; }
}
/* ===== Rent Location Gate ===== */
#rent-location-gate{position:fixed;inset:0;display:none;z-index:1100}
#rent-location-gate[aria-hidden="false"]{display:block}
#rent-location-gate .gate-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:saturate(120%) blur(2px)}
#rent-location-gate .gate-card{
  position:relative; margin:6vh auto 0; max-width:560px; background:#fff; color:#0f172a;
  border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.22); animation: gatePop .18s ease-out
}
#rent-location-gate .gate-close{position:absolute; inset-inline-end:8px; top:6px; width:36px;height:36px;
  border:none;border-radius:10px;background:#f1f5f9;cursor:pointer;font-size:20px;line-height:1}
#rent-location-gate h3{margin:.25rem 0 .35rem; font-size:1.25rem; font-weight:900}
#rent-location-gate .gate-note{margin:0 0 .6rem; color:#64748b; font-size:.95rem}
#rent-location-gate .gate-fields{display:grid; gap:10px; margin:.5rem 0 .8rem}
#rent-location-gate .gate-label{font-weight:700; font-size:.9rem}
#rent-location-gate .gate-input{
  width:100%; height:2.6rem; border:1px solid #e2e8f0; border-radius:12px; padding:.55rem .75rem; font-size:1rem
}
#rent-location-gate .gate-actions{display:flex; gap:8px; align-items:center; justify-content:flex-start}
#rent-location-gate .gate-btn{
  border:1px solid #e2e8f0; background:#fff; color:#0f172a; border-radius:12px; padding:.6rem .9rem; font-weight:800; cursor:pointer
}
#rent-location-gate .gate-primary{ background:#0f172a; color:#fff; border-color:#0f172a }
@keyframes gatePop{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

@media (max-width:640px){
  #rent-location-gate .gate-card{ margin:10vh 12px 0; padding:14px }
  #rent-location-gate h3{ font-size:1.1rem }
  #rent-location-gate .gate-note{ font-size:.9rem }
  #rent-location-gate .gate-input{ height:2.4rem; font-size:.95rem }
  #rent-location-gate .gate-btn{ padding:.5rem .8rem; font-size:.95rem }
}

  </style>
</head>
<body>
<%
  const _isAuth      = (typeof isAuth !== 'undefined') ? isAuth : false;
  const _user        = (typeof user   !== 'undefined') ? user   : null;
  const _currentPath = (typeof currentPath !== 'undefined') ? currentPath : '/rent';
  const _farmsSSR    = (typeof farms !== 'undefined' && Array.isArray(farms)) ? farms : [];
  function esc(x){ return String(x ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m])); }
  function num(n){ const v = Number(n); return Number.isFinite(v) ? v : 0; }
%>

<%- include('partials/navbar', { isAuth: _isAuth, user: _user, currentPath: _currentPath }) %>

<%- include('partials/whatsapp') %>
<%- include('partials/promo-swiper', { bannersDoc }) %>

<!-- ===== Ø¨ÙˆØ§Ø¨Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Rent) ===== -->
<div id="rent-location-gate" aria-hidden="true">
  <div class="gate-backdrop" data-close="1"></div>
  <div class="gate-card" role="dialog" aria-modal="true" aria-labelledby="rent-gate-title">
    <button class="gate-close" type="button" aria-label="Ø¥ØºÙ„Ø§Ù‚" data-close="1">Ã—</button>
    <h3 id="rent-gate-title">Ø£ÙŠÙ† ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø­Ø«ØŸ</h3>
    <p class="gate-note">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠÙ‹Ø§) Ù„Ù†Ø¸Ù‡Ø± Ù„Ùƒ Ù†ØªØ§Ø¦Ø¬ Ø£Ø¯Ù‚Ù‘.</p>

    <div class="gate-fields">
      <label class="gate-label" for="rent-gate-city">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
      <select id="rent-gate-city" class="gate-input">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©â€¦</option>
        <option>Ø¯Ù…Ø´Ù‚</option>
        <option>Ø±ÙŠÙ Ø¯Ù…Ø´Ù‚</option>
        <option>Ø­Ù„Ø¨</option>
        <option>Ø­Ù…Øµ</option>
        <option>Ø­Ù…Ø§Ø©</option>
        <option>Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©</option>
        <option>Ø·Ø±Ø·ÙˆØ³</option>
        <option>Ø¥Ø¯Ù„Ø¨</option>
        <option>Ø¯ÙŠØ± Ø§Ù„Ø²ÙˆØ±</option>
        <option>Ø§Ù„Ø­Ø³ÙƒØ©</option>
        <option>Ø§Ù„Ø±Ù‚Ø©</option>
        <option>Ø¯Ø±Ø¹Ø§</option>
        <option>Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©</option>
        <option>Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡</option>
      </select>

      <label class="gate-label" for="rent-gate-area">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="rent-gate-area" class="gate-input" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø¯Ø³ÙŠØ§ØŒ Ø§Ù„Ù…Ø²Ø©ØŒ..." />
    </div>

    <div class="gate-actions">
      <button id="rent-gate-apply" class="gate-btn gate-primary" type="button">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      <button class="gate-btn" type="button" data-close="1">ØªØ®Ø·Ù‘ÙŠ Ø§Ù„Ø¢Ù†</button>
    </div>
  </div>
</div>

<!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
<section id="filters" class="section filters" aria-labelledby="filters-title">
  <div class="container">
    <details class="filter-dropdown" open>
      <summary id="filters-title">ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</summary>

      <form id="rent-filters" class="filters-form" action="#results" method="get" novalidate>
        <div class="filters-grid">
          <!-- ØªØ¸Ù‡Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ -->
<div class="field">
  <label class="label" for="city">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
  <select id="city" name="city" class="input">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©â€¦</option>
    <option>Ø¯Ù…Ø´Ù‚</option>
    <option>Ø±ÙŠÙ Ø¯Ù…Ø´Ù‚</option>
    <option>Ø­Ù„Ø¨</option>
    <option>Ø­Ù…Øµ</option>
    <option>Ø­Ù…Ø§Ø©</option>
    <option>Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©</option>
    <option>Ø·Ø±Ø·ÙˆØ³</option>
    <option>Ø¥Ø¯Ù„Ø¨</option>
    <option>Ø¯ÙŠØ± Ø§Ù„Ø²ÙˆØ±</option>
    <option>Ø§Ù„Ø­Ø³ÙƒØ©</option>
    <option>Ø§Ù„Ø±Ù‚Ø©</option>
    <option>Ø¯Ø±Ø¹Ø§</option>
    <option>Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©</option>
    <option>Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡</option>
  </select>
</div>

          <div class="field">
            <label class="label" for="area">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
            <input id="area" name="area" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ù…Ø«Ø§Ù„: Ø±ÙŠÙ Ø¯Ù…Ø´Ù‚)" />
          </div>

          <!-- Ø²Ø± Ø§Ù„Ù…Ø²ÙŠØ¯ -->
          <div class="field" style="align-self:end;max-width:150px;display: inline-block;">
            <button id="toggle-more" type="button" class="btn btn-outline">Ù…Ø²ÙŠØ¯ â–¾</button>
          </div>
        </div>

        <!-- Ø¨Ù‚ÙŠØ© Ø§Ù„ÙÙ„Ø§ØªØ± (ØªÙƒÙˆÙ† Ù…Ø®ÙÙŠØ© Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹) -->
        <div id="more-filters" class="filters-grid more-fields" hidden>
          <div class="field">
            <label class="label" for="price-min">Ø§Ù„Ø³Ø¹Ø± (Ù…Ù†)</label>
            <input id="price-min" name="price_min" type="number" placeholder="Ù…Ø«Ø§Ù„: 500" />
          </div>

          <div class="field">
            <label class="label" for="price-max">Ø§Ù„Ø³Ø¹Ø± (Ø¥Ù„Ù‰)</label>
            <input id="price-max" name="price_max" type="number" placeholder="Ù…Ø«Ø§Ù„: 2500" />
          </div>

          <div class="field">
            <label class="label" for="size-min">Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Ù† Ù…Â²)</label>
            <input id="size-min" name="size_min" type="number" placeholder="Ù…Ø«Ø§Ù„: 5000" />
          </div>

          <div class="field">
            <label class="label" for="size-max">Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ø¥Ù„Ù‰ Ù…Â²)</label>
            <input id="size-max" name="size_max" type="number" placeholder="Ù…Ø«Ø§Ù„: 25000" />
          </div>
        </div>
            <div class="field field--actions" style="align-self:end;margin-top: 1rem;display: inline-block;">
            <button class="btn btn-primary" type="submit">ØªØ·Ø¨ÙŠÙ‚</button>
          </div>
      </form>
    </details>
  </div>
</section>

<!-- VIP Rent Only -->
<section id="vip-rent" class="vip-sale-section" aria-labelledby="vip-rent-title" hidden>
  <div class="container">
    <header class="section-header">
      <h2 id="vip-rent-title">Ù…Ø²Ø§Ø±Ø¹ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</h2>
      <p class="muted">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ÙØªØ­ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©.</p>
    </header>

    <div class="swiper vip-swiper" dir="rtl">
      <div class="swiper-wrapper" id="vipRentWrapper"></div>
      <div class="swiper-button-prev" aria-label="Ø§Ù„Ø³Ø§Ø¨Ù‚"></div>
      <div class="swiper-button-next" aria-label="Ø§Ù„ØªØ§Ù„ÙŠ"></div>
      <div class="swiper-pagination"></div>
    </div>
  </div>
</section>

<!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø³ÙˆÙŠØ¨Ø± Ù„Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©) -->
<section id="results" class="section results" aria-labelledby="results-title">
  <div class="container">
    <header class="section-header">
    </header>
    <div class="swiper rent-swiper" dir="rtl">
      <div class="swiper-wrapper" id="rentWrapper">
        <% if (_farmsSSR.length) { _farmsSSR.forEach(farm => {
     const cover    = (Array.isArray(farm.photos) && farm.photos[0]) ? farm.photos[0] : '/Public/placeholder.jpg';
     const titleTxt = esc(farm.title || 'â€”');
     const hasVideo = !!(farm.videoUrl);
     const tier     = (farm?.owner?.subscriptionTier || farm?.ownerTier || 'Basic');  // ğŸ‘ˆ Ø¨Ø¯Ù„ isVip ÙÙ‚Ø·
     const vw       = Number(farm.views || 0);
    if (tier === 'VIP') { return; } // Ù„Ø§ Ù†Ø±Ø³Ù… VIP ÙÙŠ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø¹Ø§Ù…

%>
  <div class="swiper-slide">
    <article class="farm-card">
      <a class="farm-link" href="/rent/farm/<%= farm._id %>" aria-label="Ø¹Ø±Ø¶ <%= titleTxt %>">
        <figure class="farm-media" style="position:relative">
          <img src="<%= cover %>" alt="<%= titleTxt %>" loading="lazy"
               onerror="this.onerror=null;this.src='/public/assets/farm-default.jpg'"/>
          <% if (hasVideo) { %>
            <span class="badge badge--video">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ</span>
          <% } %>
          <!-- ğŸ‘‡ Ø´Ø§Ø±Ø© Ø§Ù„Ø®Ø·Ø© Ø­Ø³Ø¨ tier -->
          <% if (String(tier || 'Basic').toLowerCase() !== 'basic') { %>
  <span class="badge badge--<%= tier %>"><%= tier %></span>
<% } %>

        </figure>
        <div class="farm-body">
          <h3 class="farm-title"><%= titleTxt %></h3>
          <p class="farm-location"><%= esc(farm.area||'') %> â€” <%= esc(farm.city||'') %></p>
  <% const _cur = String(farm.currency || '').toUpperCase(); %>
<p class="farm-price">
  <%= num(farm.price)
      ? ((_cur === 'SYP' ? 'Ù„.Ø³' : '$') + ' ' + num(farm.price).toLocaleString('en') + ' / Ø´Ù‡Ø±ÙŠÙ‹Ø§')
      : 'â€”' %>
</p>





          <!-- ğŸ‘‡ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª -->
          <div class="meta-views">ğŸ‘ï¸ <%= vw.toLocaleString('en') %></div>

          <span class="btn btn-outline" role="button" tabindex="0">Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
        </div>
      </a>
    </article>
  </div>
<% }) } %>

      </div>
      <div class="swiper-button-prev" aria-label="Ø§Ù„Ø³Ø§Ø¨Ù‚"></div>
      <div class="swiper-button-next" aria-label="Ø§Ù„ØªØ§Ù„ÙŠ"></div>
      <div class="swiper-pagination"></div>
    </div>

  </div>
</section>

  <%- include('partials/promo', { promoBottom }) %>

<%- include('partials/footer') %>

<!-- Swiper JS (Ù…Ù‡Ù…) -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script type="module">
  // Ø²Ø± "Ù…Ø²ÙŠØ¯" Ù„Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¨Ù‚ÙŠØ© Ø§Ù„ÙÙ„Ø§ØªØ±
const toggleBtn   = document.querySelector('#toggle-more');
const moreFilters = document.querySelector('#more-filters');

if (toggleBtn && moreFilters) {
  toggleBtn.addEventListener('click', () => {
    const isHidden = moreFilters.hasAttribute('hidden');
    if (isHidden) {
      moreFilters.removeAttribute('hidden');
      toggleBtn.textContent = 'Ø¥Ø®ÙØ§Ø¡ â–²';
    } else {
      moreFilters.setAttribute('hidden', '');
      toggleBtn.textContent = 'Ù…Ø²ÙŠØ¯ â–¾';
    }
  });
}

/* ======= Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø© ======= */
const $  = (s,ctx=document)=>ctx.querySelector(s);
const $$ = (s,ctx=document)=>Array.from(ctx.querySelectorAll(s));
const fmtEN = n => Number(n||0).toLocaleString('en');
const moneySym = c => String(c || '').toUpperCase() === 'SYP' ? 'Ù„.Ø³' : '$';

/* ======= Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© ======= */
const form          = $('#rent-filters');
const vipSection    = $('#vip-rent');
const vipWrap       = $('#vipRentWrapper');
const rentWrapper   = $('#rentWrapper');

/* ======= HTML helpers ======= */
function htmlEscape(s=''){ return String(s).replace(/[&<>"]/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m])); }
function assetPath(u){
   u = (u || '').toString().trim();
  if (/^https?:\/\/res\.cloudinary\.com\//.test(u)) {
    return u.replace('/upload/', '/upload/f_auto,q_auto,w_480/'); // ØªØµØºÙŠØ±
  }
  u = (u || '').toString().trim();
  if (/^data:/i.test(u) || /^https?:\/\//i.test(u)) return u;
  u = u.replace(/\\/g, '/').replace(/^\/?Public\//, '/public/').replace(/\/assests\//gi, '/assets/');
  if (u.startsWith('/uploads/') || u.startsWith('/public/')) return u;
  if (u.startsWith('/assets/')) return '/public' + u;
  if (u.startsWith('/')) return '/public' + u;
  return '/uploads/' + u;
}


/* ======= Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ ======= */
function rentSlide(f){
  const raw   = (Array.isArray(f.photos) && f.photos[0]) ? f.photos[0] : '/assets/farm-default.jpg';
  const cover = assetPath(raw);
  const link  = (String(f.kind || '').toLowerCase() === 'rent') ? `/rent/farm/${f._id}` : `/farm/${f._id}`;
  const loc   = f.city ? `${f.area || ''} â€” ${f.city}` : (f.area || 'â€”');
  const tierRaw = ((f.owner && f.owner.subscriptionTier) || f.ownerTier || 'Basic');
const tier    = String(tierRaw);
const showBadge = tier.toLowerCase() !== 'basic';
const badgeHTML = showBadge ? `<span class="badge badge--${tier}">${tier}</span>` : '';  
  const vws   = Number(f.views || 0); // ğŸ‘ˆ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª

  return `
    <div class="swiper-slide">
      <article class="farm-card">
        <a class="farm-link" href="${link}" aria-label="${htmlEscape(f.title || 'Ù…Ø²Ø±Ø¹Ø©')}">
          <figure class="farm-media" style="position:relative">
            <img src="${cover}"
     alt="${htmlEscape(f.title || 'Ù…Ø²Ø±Ø¹Ø©')}"
     loading="lazy" decoding="async" fetchpriority="low"
     sizes="(max-width:640px) 45vw, (max-width:1024px) 30vw, 280px"
     onerror="this.onerror=null;this.src='/public/assets/farm-default.jpg'">

            ${f.videoUrl ? `<span class="badge badge--video">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ</span>` : ``}
            ${badgeHTML}
          </figure>
          <div class="farm-body">
            <h3 class="farm-title">${htmlEscape(f.title || 'â€”')}</h3>
            <p class="farm-location">${htmlEscape(loc)}</p>
            <p class="farm-price">${
  Number(f.price || 0)
    ? (moneySym(f.currency) + ' ' + fmtEN(f.price) + ' / Ø´Ù‡Ø±ÙŠÙ‹Ø§')
    : 'â€”'
}</p>
            <div class="meta-views">ğŸ‘ï¸ ${fmtEN(vws)}</div>
            <span class="btn btn-outline" role="button" tabindex="0">Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
          </div>
        </a>
      </article>
    </div>`;
}

// VIP ÙŠØ³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø¹Ø§Ù…
function vipSlide(f){
  return rentSlide(f);
}

/* ======= Ø¬Ù„Ø¨ API ======= */
async function fetchJSON(url){
  const r = await fetch(url, { headers: { 'Accept':'application/json' }});
  if (!r.ok) throw new Error('HTTP '+r.status);
  const j = await r.json();
  return j.data || j.rows || [];
}

/* ======= Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø³ÙˆÙŠØ¨Ø±Ø§Øª ======= */
let allRent = [];
let vipAll  = [];
let rentSwiper = null;
let vipSwiper  = null;
let nonVipRent = [];
function destroySwiper(sw){ if (sw) try{ sw.destroy(true,true); }catch(_){} }

function initRentSwiper(){
  destroySwiper(rentSwiper);
  rentSwiper = new Swiper('.rent-swiper', {
    watchOverflow: true,
    pagination: { el: '.rent-swiper .swiper-pagination', clickable: true },
    navigation: {
      nextEl: '.rent-swiper .swiper-button-next',
      prevEl: '.rent-swiper .swiper-button-prev'
    },preloadImages: false,
lazy: { loadPrevNext: true, loadPrevNextAmount: 2 },
watchSlidesProgress: true,

    breakpoints: {
      /* Ù‡Ø§ØªÙ: ÙƒØ±ØªÙŠÙ† */
      0:    { slidesPerView: 2.02, spaceBetween: 10 },
      480:  { slidesPerView: 2.10, spaceBetween: 12 },
      /* ØªØ§Ø¨Ù„Øª ØµØºÙŠØ± */
      640:  { slidesPerView: 2.4,  spaceBetween: 14 },
      /* Ø£ÙƒØ¨Ø± */
      1024: { slidesPerView: 3.2,  spaceBetween: 18 },
      1280: { slidesPerView: 4.2,  spaceBetween: 20 }
    }
  });
}
function initVipSwiper(){
  destroySwiper(vipSwiper);
  vipSwiper = new Swiper('.vip-swiper', {
    slidesPerView: 1.05,
    spaceBetween: 12,
    watchOverflow: true,
    pagination: { el: '.vip-swiper .swiper-pagination', clickable: true },
    navigation: {
      nextEl: '.vip-swiper .swiper-button-next',
      prevEl: '.vip-swiper .swiper-button-prev'
    },preloadImages: false,
lazy: { loadPrevNext: true, loadPrevNextAmount: 2 },
watchSlidesProgress: true,

   breakpoints: {
      /* Ù‡Ø§ØªÙ: ÙƒØ±ØªÙŠÙ† */
      0:    { slidesPerView: 2.02, spaceBetween: 10 },
      480:  { slidesPerView: 2.10, spaceBetween: 12 },
      /* ØªØ§Ø¨Ù„Øª ØµØºÙŠØ± */
      640:  { slidesPerView: 2.4,  spaceBetween: 14 },
      /* Ø£ÙƒØ¨Ø± */
      1024: { slidesPerView: 3.2,  spaceBetween: 18 },
      1280: { slidesPerView: 4.2,  spaceBetween: 20 }
    }
  });
}


function renderRent(list){
  if (!rentWrapper) return;
  rentWrapper.innerHTML = (list && list.length) ? list.map(rentSlide).join('') : `<div class="empty muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`;
  initRentSwiper();
}
function renderVip(list){
  if (!vipSection || !vipWrap) return;
  const has = Array.isArray(list) && list.length>0;
  vipSection.hidden = !has;
  vipWrap.innerHTML = has ? list.map(vipSlide).join('') : '';
  if (has) initVipSwiper(); else destroySwiper(vipSwiper);
}

/* ======= ÙÙ„Ø§ØªØ± ======= */
function applyFilters(){
  const area  = (form?.area?.value||'').trim().toLowerCase();
  const city  = (form?.city?.value||'').trim().toLowerCase();
  const minP  = parseFloat(form?.price_min?.value);
  const maxP  = parseFloat(form?.price_max?.value);
  const minS  = parseFloat(form?.size_min?.value);
  const maxS  = parseFloat(form?.size_max?.value);

  const pass = (f)=>{
    const fArea = (f.area||'').toString().toLowerCase();
    const fCity = (f.city||'').toString().toLowerCase();
    const okArea  = !area || fArea.includes(area);
    const okCity  = !city || fCity.includes(city);
    const price   = Number(f.price)||0;
    const size    = Number(f.size)||0;
    const okPrice = (isNaN(minP) || price>=minP) && (isNaN(maxP) || price<=maxP);
    const okSize  = (isNaN(minS) || size>=minS)   && (isNaN(maxS) || size<=maxS);
    return okArea && okCity && okPrice && okSize;
  };

  const filteredRent = nonVipRent.filter(pass); 
  const filteredVip  = vipAll.filter(pass);
  renderRent(filteredRent);
  renderVip(filteredVip);
}

/* ======= Ø¨Ø¯Ø¡ ======= */
async function init(){
  try {
    // Ø¯ÙØ¹Ø© Ø£ÙˆÙ„Ù‰ ØµØºÙŠØ±Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹
    const first = await fetchJSON('/api/farms/rent?limit=24');
    allRent = Array.isArray(first) ? first : [];

    // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ VIP Ù…Ù† Ø§Ù„Ø¹Ø§Ù…
    nonVipRent = allRent.filter(f => ((f?.owner?.subscriptionTier) || f.ownerTier || 'Basic') !== 'VIP');
    renderRent(nonVipRent);

    // Ù„Ø§Ø­Ù‚Ù‹Ø§: Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¶Ø¹Ù‡Ø§ Ø¨Ù‡Ø¯ÙˆØ¡
    requestIdleCallback(async () => {
      try{
        const rest = await fetchJSON('/api/farms/rent?limit=60');
        allRent = rest;
        nonVipRent = allRent.filter(f => ((f?.owner?.subscriptionTier) || f.ownerTier || 'Basic') !== 'VIP');
        renderRent(nonVipRent);
      }catch(_){}
    });
  } catch(e){ console.warn('rent fetch error:', e); renderRent([]); }

  // VIP Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ (Ø¹Ø¯Ø¯ Ø£Ù‚Ù„)
  try {
    vipAll = await fetchJSON('/api/farms/rent?vipOnly=1&limit=24');
    renderVip(vipAll);
  } catch(e){ console.warn('vip fetch error:', e); renderVip([]); }

  // Ø±Ø¨Ø· Ø§Ù„ÙÙ„Ø§ØªØ± ÙƒÙ…Ø§ Ù‡Ùˆâ€¦
  if (form){
    form.addEventListener('submit', e=>{ e.preventDefault(); applyFilters(); });
    $$('#rent-filters input, #rent-filters select').forEach(inp=>{
      inp.addEventListener('change', applyFilters);
      inp.addEventListener('input',  e=>{
        const n = (e.target?.name||'');
        if (/price_|size_|area|city/.test(n)) applyFilters();
      });
    });
  }
}


document.addEventListener('DOMContentLoaded', init);
</script>
<script>
  (function(){
    const gate       = document.getElementById('rent-location-gate');
    const gateCity   = document.getElementById('rent-gate-city');
    const gateArea   = document.getElementById('rent-gate-area');
    const btnApply   = document.getElementById('rent-gate-apply');

    // Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£ØµÙ„Ù‹Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø©:
    const filterCity = document.getElementById('city');
    const filterArea = document.getElementById('area');

    function openGate(){ gate?.setAttribute('aria-hidden','false'); }
    function closeGate(){ gate?.setAttribute('aria-hidden','true'); }

    // Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©/Ã—/ØªØ®Ø·Ù‘ÙŠ
    document.addEventListener('click', (e)=>{
      const t = e.target;
      if (t?.dataset?.close){ closeGate(); }
      if (t?.classList?.contains('gate-backdrop')){ closeGate(); }
    });

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± â†” ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙ„Ø§ØªØ± â†” ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ„ØªØ±Ø©
    btnApply?.addEventListener('click', ()=>{
      const c = (gateCity?.value || '').trim();
      const a = (gateArea?.value || '').trim();

      if (filterCity) filterCity.value = c;
      if (filterArea) filterArea.value = a;

      try { sessionStorage.setItem('rentLocationChosen','1'); } catch(_){}

      try { window.applyFilters && window.applyFilters(); } catch(_){}
      closeGate();

      // Ø§Ù†Ø²Ù„ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      const sec = document.getElementById('results');
      if (sec) sec.scrollIntoView({ behavior:'smooth', block:'start' });
    });

    // Ø§ÙØªØ­ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ Ø¬Ù„Ø³Ø©ØŒ ÙˆÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ city/area Ø¨Ø§Ù„Ù€URL
    function shouldOpen(){
      try { if (sessionStorage.getItem('rentLocationChosen')==='1') return false; } catch(_){}
      const url = new URL(location.href);
      const hasQ = url.searchParams.get('city') || url.searchParams.get('area');
      return !hasQ;
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      if (shouldOpen()) openGate();
    });
  })();
</script>

<%- include('partials/mobile-nav', { 
  activeTab: 'rent',   // ØºÙŠÙ‘Ø±Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©: 'home' | 'sale' | 'rent' | 'contractors' | 'dash'
  isAuth, isAdmin, isContractor, isOwner,
}) %>
</body>
</html>
