<% const list = Array.isArray(items) ? items : []; %>
<section class="section" aria-labelledby="top-rent-title">
  <div class="container">
    <header class="section-header">
      <h3 id="top-rent-title" >أكثر مزارع الإيجار مشاهدة</h3>
    </header>

    <% if (!list.length) { %>
      <p class="muted">لا توجد عناصر.</p>
    <% } else { %>
      <style>
        .top-rent-swiper .swiper-slide{ height:auto; }
        .top-rent-card{display:block;border:1px solid #e2e8f0;border-radius:14px;overflow:hidden;background:#fff}
        .top-rent-card img{width:100%;height:220px;object-fit:cover}
        .top-rent-body{padding:.8rem}
        .top-rent-title{margin:.2rem 0 .4rem;font-size:1.05rem ;text-align: center;margin-bottom: 1rem;}
        .top-rent-loc,.top-rent-price{margin:0 0 .25rem;color:#475569}
        .top-rent-meta{font-size:.9rem;color:#475569}
        .top-rent-link{display:inline-block;border:1px solid #0f172a;border-radius:10px;padding:.35rem .7rem;text-decoration:none}
      </style>

      <div class="swiper top-rent-swiper" dir="rtl">
        <div class="swiper-wrapper">
          <% list.forEach(f => { %>
            <div class="swiper-slide">
              <article class="top-rent-card">
                <a class="top-rent-link-area" href="/rent/farm/<%= f._id %>" aria-label="عرض <%= f.title %>">
                  <figure class="top-rent-media">
                    <img src="<%= (Array.isArray(f.photos)&&f.photos[0]) ? f.photos[0] : '/public/assets/farm-default.jpg' %>" alt="<%= f.title %>" loading="lazy"
                         onerror="this.onerror=null;this.src='/public/assets/farm-default.jpg'"/>
                  </figure>
                  <div class="top-rent-body">
                    <h4 class="top-rent-title"><%= f.title %></h4>
                    <p class="top-rent-loc"><%= f.city ? ((f.area||'') + ' — ' + f.city) : (f.area||'—') %></p>
                    <p class="top-rent-price">$<%= Number(f.price||0).toLocaleString('en') %> / شهريًا</p>
                    <div class="top-rent-meta">👁️ <%= Number(f.views||0).toLocaleString('en') %></div>
                    <span class="top-rent-link" role="button" tabindex="0">التفاصيل</span>
                  </div>
                </a>
              </article>
            </div>
          <% }) %>
        </div>
        <div class="swiper-button-prev" aria-label="السابق"></div>
        <div class="swiper-button-next" aria-label="التالي"></div>
        <div class="swiper-pagination"></div>
      </div>

      <script type="module">
        import Swiper from 'https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs';
        new Swiper('.top-rent-swiper', {
          slidesPerView: 1.05,
          spaceBetween: 12,
          watchOverflow: true,
          pagination: { el: '.top-rent-swiper .swiper-pagination', clickable: true },
          navigation: {
            nextEl: '.top-rent-swiper .swiper-button-next',
            prevEl: '.top-rent-swiper .swiper-button-prev'
          },
          breakpoints: {
            480:  { slidesPerView: 1.2,  spaceBetween: 14 },
            640:  { slidesPerView: 2.2,  spaceBetween: 16 },
            1024: { slidesPerView: 3.2,  spaceBetween: 18 },
            1280: { slidesPerView: 4.2,  spaceBetween: 20 }
          }
        });
      </script>
    <% } %>
  </div>
</section>
