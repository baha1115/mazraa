<!-- views/contractors.ejs -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="alternate icon" type="image/png" href="../public/assests/logo.png">
  <title>Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† Ù„ØªØ¬Ù‡ÙŠØ² ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ ÙˆØ§Ù„Ù…Ù†Ø§Ø²Ù„ ÙÙŠ Ø³ÙˆØ±ÙŠØ§ â€“ Ù…Ø²Ø±Ø¹ØªÙŠ</title>
<meta name="description" content="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† Ù…ÙˆØ«ÙˆÙ‚ÙŠÙ† Ù„ØªØ¬Ù‡ÙŠØ² ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ ÙˆØ§Ù„Ù…Ù†Ø§Ø²Ù„ ÙÙŠ Ø³ÙˆØ±ÙŠØ§: Ù†Ø¬Ø§Ø± Ø¨Ø§Ø·ÙˆÙ†ØŒ Ù…Ø¹Ù…Ø±Ø¬ÙŠ Ø­Ø¬Ø± ÙˆØ¨Ù„ÙˆÙƒØŒ ØªÙ…Ø¯ÙŠØ¯Ø§Øª ØµØ­ÙŠØ© ÙˆÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©ØŒ Ø¯ÙŠÙƒÙˆØ±Ø§ØªØŒ ØªØ¯ÙØ¦Ø© ÙˆØªØ¨Ø±ÙŠØ¯ØŒ Ø£Ù„Ù…Ù†ÙŠÙˆÙ…ØŒ Ù…Ø³Ø§Ø¨Ø­ØŒ Ù…Ø³Ø§Ø¨Ø­ØŒ Ù…Ø¸Ù„Ø§Øª ÙˆØ®Ø¯Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ù„ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ ÙˆØ§Ù„Ù…Ù†Ø§Ø²Ù„.">

  <link rel="stylesheet" href="/Public/styles/contractorsstyle.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

  <style>
   /* ==== VIP hero ==== */
.vip-hero-slide{position:relative;min-height:360px;border-radius:16px;overflow:hidden;background:#f6faf6;}
@media (min-width:1024px){.vip-hero-slide{min-height:520px;}}
.vip-hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.85);}
.vip-hero-overlay{position:absolute;inset:0;background:linear-gradient(90deg,rgba(0,0,0,.35),rgba(0,0,0,.15) 40%,rgba(0,0,0,0) 70%);}
.vip-hero-body{position:absolute;inset-inline:1.2rem;inset-block-end:1.1rem;color:#fff;display:grid;gap:.35rem;}
.vip-hero-title{font-size:clamp(20px,3vw,34px);margin:.25rem 0 0;}
.vip-hero-meta{opacity:.95;font-size:clamp(14px,1.5vw,16px);}
.vip-hero-cta{margin-top:.6rem;display:inline-block;padding:.5rem .9rem;border-radius:10px;background:#fff;color:#0f172a;text-decoration:none;font-weight:600;width:150px;text-align:center;}
.vip-badge{position:absolute;top:12px;inset-inline-start:12px;background:#0f172a;color:#fff;border-radius:999px;font-size:.8rem;padding:.18rem .6rem;z-index:2}
/* ==== Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† (ØªØµÙ…ÙŠÙ… Ø£Ù†Ø¸Ù ÙˆÙ…ØªÙ†Ø§Ø³Ù‚) ==== */

/* Ø³Ù„Ø§ÙŠØ¯ Ø§Ù„Ø³ÙˆÙŠØ¨Ø± ÙŠØ£Ø®Ø° Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙƒØ±Øª */
.contractor-swiper .swiper-slide{
  height:auto;
}

/* Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
.contractor-card{
  position:relative;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:14px 12px 12px;
  padding-top:42px;
  border-radius:18px;
  border:1px solid #e5e7eb;
  background:linear-gradient(135deg,#ffffff,#f9fafb);
  box-shadow:0 4px 14px rgba(15,23,42,.06);
  height:100%;
  min-height:240px;
  overflow:hidden;
  transition:
    transform .16s ease,
    box-shadow .16s ease,
    border-color .16s ease,
    background .16s ease;
}

.contractor-card:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 24px rgba(15,23,42,.1);
  border-color:#d1d5db;
  background:linear-gradient(135deg,#ffffff,#f3f4f6);
}

/* Ø´Ø§Ø±Ø© Ø§Ù„Ø®Ø·Ø© (VIP / Premium) */
.tier-badge{
  position:absolute;
  top:10px;
  inset-inline-end:10px;
  background:#0f172a;
  color:#fff;
  border-radius:999px;
  font-size:.78rem;
  padding:.18rem .7rem;
  line-height:1;
  font-weight:700;
  letter-spacing:.3px;
}

/* Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ: ØµÙˆØ±Ø© + Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
.card-row{
  display:flex;
  align-items:center;
  gap:12px;
}

.avatar{
  width:68px;
  height:68px;
  border-radius:999px;
  overflow:hidden;
  border:3px solid #e5e7eb;
  flex-shrink:0;
}

.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.info-stack{
  display:flex;
  flex-direction:column;
  gap:3px;
  min-width:0;
}

.name{
  margin:0;
  font-weight:800;
  font-size:1.02rem;
  color:#0f172a;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.specialization,
.region{
  margin:0;
  color:#64748b;
  font-size:.88rem;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Ø§Ù„ØªÙ‚ÙŠÙŠÙ… */
.rating{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:.35rem;
  font-weight:700;
  color:#111827;
  font-size:.9rem;
}

.rating span:last-child{
  font-size:.95rem;
}

.rating small{
  color:#6b7280;
  font-weight:600;
}

/* Ø²Ø± ØµÙØ­Ø© Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ */
.card-cta{
  margin-top:auto;           /* ÙŠØ¨Ù‚ÙŠ Ø§Ù„Ø²Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ÙƒØ±Øª */
  width:100%;
  text-align:center;
  border:1px solid #0f172a;
  border-radius:12px;
  padding:.5rem .85rem;
  text-decoration:none;
  color:#0f172a;
  font-weight:700;
  display:inline-block;
  font-size:.9rem;
  background:#ffffff;
  transition:
    background .14s ease,
    color .14s ease,
    border-color .14s ease;
}

.card-cta:hover{
  background:#0f172a;
  color:#ffffff;
  border-color:#0f172a;
}

/* ===== Ù…ÙˆØ¨Ø§ÙŠÙ„: Ø§Ù„ÙƒØ±Øª ÙŠØµØ¨Ø­ Ø¹Ù…ÙˆØ¯ÙŠ ÙˆÙ…Ø±ÙƒÙ‘Ø² ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ===== */
@media (max-width:640px){
  .contractor-card{
    padding:12px 10px 10px;
    border-radius:14px;
    min-height:210px;
    box-shadow:0 3px 12px rgba(15,23,42,.08);
  }

  /* Ù†Ø®Ù„ÙŠ Ø§Ù„ØµÙˆØ±Ø© ÙÙˆÙ‚ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ØªÙ‡Ø§ØŒ ÙƒÙ„Ù‡ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
  .card-row{
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap:8px;
  }

  .avatar{
    width:60px;
    height:60px;
    border-width:2px;
  }

  .info-stack{
    align-items:center;
  }

  .name{
    font-size:.95rem;
    white-space:nowrap;
  }

  .specialization,
  .region{
    font-size:.8rem;
    white-space:normal;       /* ÙŠØ³Ù…Ø­ Ø¨Ø³Ø·Ø±ÙŠÙ† Ù„Ùˆ Ø§Ù„Ù†Øµ Ø·ÙˆÙŠÙ„ */
    text-overflow:clip;
  }

  .rating{
    justify-content:center;
    font-size:.86rem;
    gap:.3rem;
  }

  .rating small{
    font-size:.8rem;
  }

  .card-cta{
    font-size:.86rem;
    padding:.42rem .7rem;
    border-radius:10px;
    margin-top:auto;          /* ÙŠØ¨Ù‚Ù‰ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ÙƒØ±Øª Ø­ØªÙ‰ ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  }

  .tier-badge{
    font-size:.72rem;
    padding:.16rem .5rem;
    top:8px;
    inset-inline-end:8px;
  }
}

/* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙÙ‚Ø· */
@media (max-width:640px){
  #filters .filter-dropdown > summary{display:none !important;}
  #filters .filters-form button[type="submit"]{display:none !important;}
  #filters #toggle-more{display:none !important;}
  #filters .filters-form{padding-top:0 !important;}
  #filters .filters-grid{margin-top:0 !important;}
}

/* ===== Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø­Ø§Ø±Ø³ ===== */
#contractor-gate{position:fixed;inset:0;display:none;z-index:1100;}
#contractor-gate[aria-hidden="false"]{display:block;}
#contractor-gate .gate-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:saturate(120%) blur(2px);}
#contractor-gate .gate-card{
  position:relative;margin:6vh auto 0;max-width:560px;background:#fff;color:#0f172a;
  border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.22);animation:gatePop .18s ease-out;
}
#contractor-gate .gate-close{
  position:absolute;inset-inline-end:8px;top:6px;width:36px;height:36px;border:none;border-radius:10px;
  background:#f1f5f9;cursor:pointer;font-size:20px;line-height:1;
}
#contractor-gate h3{margin:.25rem 0 .35rem;font-size:1.25rem;font-weight:900;}
#contractor-gate .gate-note{margin:0 0 .6rem;color:#64748b;font-size:.95rem;}
#contractor-gate .gate-fields{display:grid;gap:10px;margin:.5rem 0 .8rem;}
#contractor-gate .gate-label{font-weight:700;font-size:.9rem;}
#contractor-gate .gate-input{
  width:100%;height:2.6rem;border:1px solid #e2e8f0;border-radius:12px;
  padding:.55rem .75rem;font-size:1rem;
}
#contractor-gate .gate-actions{display:flex;gap:8px;align-items:center;justify-content:flex-start;}
#contractor-gate .gate-btn{
  border:1px solid #e2e8f0;background:#fff;color:#0f172a;border-radius:12px;
  padding:.6rem .9rem;font-weight:800;cursor:pointer;
}
#contractor-gate .gate-primary{background:#0f172a;color:#fff;border-color:#0f172a;}
@keyframes gatePop{from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)}}
@media (max-width:640px){
  #contractor-gate .gate-card{margin:10vh 12px 0;padding:14px;}
  #contractor-gate h3{font-size:1.1rem;}
  #contractor-gate .gate-note{font-size:.9rem;}
  #contractor-gate .gate-input{height:2.4rem;font-size:.95rem;}
  #contractor-gate .gate-btn{padding:.5rem .8rem;font-size:.95rem;}
}
/* Ø¥Ø®ÙØ§Ø¡ Ù†Ù‚Ø§Ø· Ø§Ù„Ø³ÙˆÙŠØ¨Ø± ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© */
.contractor-swiper .swiper-pagination,
.rent-swiper .swiper-pagination,
.sale-swiper .swiper-pagination,
.vip-swiper .swiper-pagination{
  display: none !important;
}
.contractor-swiper .swiper-wrapper{
  align-items:stretch;
}

  </style>
</head>
<body>

  <%- include('partials/navbar', { isAuth: (typeof isAuth!=='undefined'?isAuth:false), user: (typeof user!=='undefined'?user:null), active: 'contractors' }) %>

 <%- include('partials/whatsapp') %>
<%- include('partials/promo-swiper', { bannersDoc }) %>
  <!-- ===== Ø¨ÙˆØ§Ø¨Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† (ØªØ®ØµØµ + Ù…Ø­Ø§ÙØ¸Ø©) ===== -->
<div id="contractor-gate" aria-hidden="true">
  <div class="gate-backdrop" data-close="1"></div>

  <div class="gate-card" role="dialog" aria-modal="true" aria-labelledby="con-gate-title">
    <button class="gate-close" type="button" aria-label="Ø¥ØºÙ„Ø§Ù‚" data-close="1">Ã—</button>

    <h3 id="con-gate-title">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‚Ø§ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ØªØ®ØµØµ ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸Ø©</h3>
    <p class="gate-note">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ Ø«Ù… Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù„Ù†ÙØ¸Ù‡Ø± Ù†ØªØ§Ø¦Ø¬ Ø£Ø¯Ù‚.</p>

    <div class="gate-fields">
     <label class="gate-label" for="gate-spec">Ø§Ù„ØªØ®ØµØµ</label>
<select id="gate-spec" class="gate-input">
  <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµâ€¦</option>
  <option>Ù†Ø¬Ø§Ø± Ø¨Ø§Ø·ÙˆÙ†</option>
  <option>Ù…Ø¹Ù…Ø±Ø¬ÙŠ Ø­Ø¬Ø± ÙˆØ¨Ù„ÙˆÙƒ</option>
  <option>Ù…Ù„ÙŠØ³</option>
  <option>Ù…Ø¨Ù„Ø·</option>
  <option>ÙÙ†ÙŠ Ù…Ù…Ø¯Ø¯ ØµØ­ÙŠØ©</option>
  <option>ÙÙ†ÙŠ Ù…Ø¯Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
  <option>Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø±ÙŠ Ø²Ø±Ø§Ø¹ÙŠ</option>
  <option>ÙÙ†ÙŠ Ø¬Ø¨Ø³ Ø¨ÙˆØ±Ø¯ ÙˆØ¯ÙŠÙƒÙˆØ±Ø§Øª</option>
  <option>Ø¯Ù‡Ø§Ù†</option>
  <option>Ø­Ø¯Ø§Ø¯ Ø§ÙØ±Ù†Ø¬ÙŠ</option>
  <option>ÙÙ†ÙŠ ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ</option>
  <option>ÙÙ†ÙŠ ØªØ¯ÙØ¦Ø© Ù…Ø±ÙƒØ²ÙŠØ© ÙˆØ·Ø§Ù‚Ø© Ù…ÙŠØ§Ù‡ Ø´Ù…Ø³ÙŠØ©</option>
  <option>Ù†Ø¬Ø§Ø± Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
  <option>ÙÙ†ÙŠ ØªØµÙ…ÙŠÙ… ÙˆØªØ±ÙƒÙŠØ¨ Ø¨Ù„ÙˆØ±</option>
  <option>Ù†Ø¬Ø§Ø± Ø®Ø´Ø¨ Ø¹Ø±Ø¨ÙŠ</option>
  <option>Ù†Ø¬Ø§Ø± Ø®Ø´Ø¨ Ø§ÙØ±Ù†Ø¬ÙŠ</option>
  <option>ÙÙ†ÙŠ ØªØµÙ…ÙŠÙ… ÙˆØ¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ø­</option>
  <option>ÙÙ†ÙŠ Ù…Ø´ØªÙ„ Ù†Ø¨Ø§ØªØ§Øª ÙˆØ£Ø´Ø¬Ø§Ø±</option>
  <option>ÙÙ†ÙŠ Ø´ÙˆØ§Ø¯Ø± ÙˆÙ…Ø¸Ù„Ø§Øª</option>
  <option>ØªØµÙ…ÙŠÙ… Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø·ÙŠÙ†</option>
  <option>Ù…Ù‚Ø§ÙˆÙ„ / Ù…ØªØ¹Ù‡Ø¯ Ø¥Ù†Ø´Ø§Ø¡Ø§Øª</option>
</select>

      <label class="gate-label" for="gate-city">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
      <select id="gate-city" class="gate-input">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©â€¦</option>
        <option>Ø¯Ù…Ø´Ù‚</option><option>Ø±ÙŠÙ Ø¯Ù…Ø´Ù‚</option><option>Ø­Ù„Ø¨</option><option>Ø­Ù…Øµ</option>
        <option>Ø­Ù…Ø§Ø©</option><option>Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©</option><option>Ø·Ø±Ø·ÙˆØ³</option><option>Ø¥Ø¯Ù„Ø¨</option>
        <option>Ø¯ÙŠØ± Ø§Ù„Ø²ÙˆØ±</option><option>Ø§Ù„Ø­Ø³ÙƒØ©</option><option>Ø§Ù„Ø±Ù‚Ø©</option>
        <option>Ø¯Ø±Ø¹Ø§</option><option>Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©</option><option>Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡</option>
      </select>
    </div>

    <div class="gate-actions">
      <button id="gate-apply" class="gate-btn gate-primary" type="button">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      <button class="gate-btn" type="button" data-close="1">ØªØ®Ø·Ù‘ÙŠ Ø§Ù„Ø¢Ù†</button>
    </div>
  </div>
</div>

  <!-- ÙÙ„Ø§ØªØ± Ø¨Ø³ÙŠØ·Ø© -->
  <section id="filters" class="section filters" aria-labelledby="filters-title">
    <div class="container">
      <details class="filter-dropdown" open>
        <summary id="filters-title">ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ†</summary>
   <form id="contractor-filters" class="filters-form" action="#results" method="get" novalidate>
  <div class="filters-grid" style="display:grid;gap:.8rem;grid-template-columns:repeat(12,1fr)">
    <!-- Ø§Ù„ØªØ®ØµØµ: Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© -->
    <div class="field" style="grid-column:span 6">
      <label class="label" for="specialization">Ø§Ù„ØªØ®ØµØµ</label>
     <select id="specialization" name="specialization" class="input">
  <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµâ€¦</option>
  <option>Ù†Ø¬Ø§Ø± Ø¨Ø§Ø·ÙˆÙ†</option>
  <option>Ù…Ø¹Ù…Ø±Ø¬ÙŠ Ø­Ø¬Ø± ÙˆØ¨Ù„ÙˆÙƒ</option>
  <option>Ù…Ù„ÙŠØ³</option>
  <option>Ù…Ø¨Ù„Ø·</option>
  <option>ÙÙ†ÙŠ Ù…Ù…Ø¯Ø¯ ØµØ­ÙŠØ©</option>
  <option>ÙÙ†ÙŠ Ù…Ø¯Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
  <option>Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø±ÙŠ Ø²Ø±Ø§Ø¹ÙŠ</option>
  <option>ÙÙ†ÙŠ Ø¬Ø¨Ø³ Ø¨ÙˆØ±Ø¯ ÙˆØ¯ÙŠÙƒÙˆØ±Ø§Øª</option>
  <option>Ø¯Ù‡Ø§Ù†</option>
  <option>Ø­Ø¯Ø§Ø¯ Ø§ÙØ±Ù†Ø¬ÙŠ</option>
  <option>ÙÙ†ÙŠ ØªØ¨Ø±ÙŠØ¯ ÙˆØªÙƒÙŠÙŠÙ</option>
  <option>ÙÙ†ÙŠ ØªØ¯ÙØ¦Ø© Ù…Ø±ÙƒØ²ÙŠØ© ÙˆØ·Ø§Ù‚Ø© Ù…ÙŠØ§Ù‡ Ø´Ù…Ø³ÙŠØ©</option>
  <option>Ù†Ø¬Ø§Ø± Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
  <option>ÙÙ†ÙŠ ØªØµÙ…ÙŠÙ… ÙˆØªØ±ÙƒÙŠØ¨ Ø¨Ù„ÙˆØ±</option>
  <option>Ù†Ø¬Ø§Ø± Ø®Ø´Ø¨ Ø¹Ø±Ø¨ÙŠ</option>
  <option>Ù†Ø¬Ø§Ø± Ø®Ø´Ø¨ Ø§ÙØ±Ù†Ø¬ÙŠ</option>
  <option>ÙÙ†ÙŠ ØªØµÙ…ÙŠÙ… ÙˆØ¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ø­</option>
  <option>ÙÙ†ÙŠ Ù…Ø´ØªÙ„ Ù†Ø¨Ø§ØªØ§Øª ÙˆØ£Ø´Ø¬Ø§Ø±</option>
  <option>ÙÙ†ÙŠ Ø´ÙˆØ§Ø¯Ø± ÙˆÙ…Ø¸Ù„Ø§Øª</option>
  <option>ØªØµÙ…ÙŠÙ… Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø·ÙŠÙ†</option>
  <option>Ù…Ù‚Ø§ÙˆÙ„ / Ù…ØªØ¹Ù‡Ø¯ Ø¥Ù†Ø´Ø§Ø¡Ø§Øª</option>
</select>
    </div>

    <!-- Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© -->
    <div class="field" style="grid-column:span 6">
      <label class="label" for="city">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
      <select id="city" name="city" class="input">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©â€¦</option>
        <option>Ø¯Ù…Ø´Ù‚</option>
        <option>Ø±ÙŠÙ Ø¯Ù…Ø´Ù‚</option>
        <option>Ø­Ù„Ø¨</option>
        <option>Ø­Ù…Øµ</option>
        <option>Ø­Ù…Ø§Ø©</option>
        <option>Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©</option>
        <option>Ø·Ø±Ø·ÙˆØ³</option>
        <option>Ø¥Ø¯Ù„Ø¨</option>
        <option>Ø¯ÙŠØ± Ø§Ù„Ø²ÙˆØ±</option>
        <option>Ø§Ù„Ø­Ø³ÙƒØ©</option>
        <option>Ø§Ù„Ø±Ù‚Ø©</option>
        <option>Ø¯Ø±Ø¹Ø§</option>
        <option>Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©</option>
        <option>Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡</option>
      </select>
    </div>

    <div class="field" style="grid-column:span 12;display:flex;justify-content:flex-end">
      <button class="btn btn-primary" type="submit" style="background:#0f172a;color:#fff;border:none;border-radius:10px;padding:.55rem 1rem">ØªØ·Ø¨ÙŠÙ‚</button>
    </div>
  </div>
</form>

      </details>
    </div>
  </section>
<!-- VIP -->
  <section id="vip-contractors" class="section gallery" aria-labelledby="vip-title" hidden>
    <div class="container">
      <header class="section-header">
        <h2 id="vip-title">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ÙˆÙ†</h2>
         <a href="/rates"
     style="text-decoration:none;font-weight:800;background:#fff;border:1px solid rgba(0,0,0,.08);padding:8px 12px;border-radius:12px;color:#0b4e45;box-shadow:0 6px 16px rgba(0,0,0,.06)">
     ğŸ’± Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Øª
  </a>
      </header>

      <div class="swiper vip-swiper" dir="rtl" aria-label="Ù…Ù‚Ø§ÙˆÙ„ÙˆÙ† VIP">
        <div class="swiper-wrapper" id="vipContractorsWrapper"></div>
        <div class="swiper-button-prev" aria-label="Ø§Ù„Ø³Ø§Ø¨Ù‚"></div>
        <div class="swiper-button-next" aria-label="Ø§Ù„ØªØ§Ù„ÙŠ"></div>
        <div class="swiper-pagination"></div>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø³ÙˆÙŠØ¨Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨) -->
  <section id="results" class="section list" aria-labelledby="list-title">
    <div class="container">
      <header class="section-header">
        
      </header>

      <div class="swiper contractor-swiper" dir="rtl">
        <div class="swiper-wrapper" id="contractorsWrapper">
        <% if (Array.isArray(contractors) && contractors.length) { contractors.forEach(function(c){ 
    const services = Array.isArray(c.services) ? c.services.join('ØŒ ') : (c.services || '');

    // 1ï¸âƒ£ Ù†Ø£Ø®Ø° Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ø§Ù…
    const rawAvatar = (c.avatar || '').toString().trim();
  const rawWork   = (Array.isArray(c.photos) && c.photos[0]) ? String(c.photos[0]).trim() : '';

  // âœ… avatar: Ø§Ø³Ù…Ø­ Ø¨Ù€ data: ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚ØµÙŠØ±Ø© (ØµØºÙŠØ±Ø©) â€” Ø­ØªÙ‰ Ù…Ø§ ØªÙ‚ØªÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡
  const avatarOK = rawAvatar && (
    !/^data:/i.test(rawAvatar) || rawAvatar.length < 500000   // ~ 35KB ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
  );

  // âœ… Ù„Ø§ Ù†Ø³Ù…Ø­ base64 Ù„ØµÙˆØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø£Ø¨Ø¯Ø§Ù‹
  const workOK = rawWork && !/^data:/i.test(rawWork);

  const chosen = avatarOK ? rawAvatar : (workOK ? rawWork : '');

  const img =
    (chosen && chosen.includes('res.cloudinary.com') && chosen.includes('/upload/'))
      ? chosen.replace('/upload/','/upload/f_auto,q_auto,w_160,h_160,c_fill,g_face/')
      : (chosen || '/Public/assets/contractors/default.jpg');

    const region = c.region || '';
    const tier = c.userTier || c.subscriptionTier || 'Basic';
    if (tier === 'VIP') { return; }
%>

              <div class="swiper-slide">
                <article class="contractor-card">
                  <% if (String(tier||'Basic').toLowerCase() !== 'basic') { %>
  <span class="tier-badge"><%= tier %></span>
<% } %>

                  <div class="card-row">
                    <div class="avatar"><img src="<%= img %>" alt="ØµÙˆØ±Ø© <%= c.name || 'Ù…Ù‚Ø§ÙˆÙ„' %>"
     loading="lazy" decoding="async" fetchpriority="low"
     onerror="this.onerror=null;this.src='/Public/assets/contractors/default.jpg'">
</div>
                    <div class="info-stack">
                      <h3 class="name"><%= c.name || 'â€”' %></h3>
                      <p class="specialization"><%= services || 'â€”' %></p>
                      <p class="region"><%= region || 'â€”' %></p>
                    </div>
                  </div>
                  <div class="rating"><small>(<%= c.ratingCount || 0 %>)</small><span><%= Number(c.ratingAvg||0).toFixed(2) %></span><span>â­</span></div>
                  <a class="card-cta" href="/contractor/<%= c._id %>">ØµÙØ­Ø© Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</a>
                </article>
              </div>
          <% }) } %>
        </div>
        <div class="swiper-button-prev" aria-label="Ø§Ù„Ø³Ø§Ø¨Ù‚"></div>
        <div class="swiper-button-next" aria-label="Ø§Ù„ØªØ§Ù„ÙŠ"></div>
        <div class="swiper-pagination"></div>
      </div>
    </div>
  </section>

    <%- include('partials/promo', { promoBottom }) %>
 <%- include('partials/footer') %>

<script defer src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <script>
    const $  = (s,ctx=document)=>ctx.querySelector(s);
    const $$ = (s,ctx=document)=>Array.from(ctx.querySelectorAll(s));
    const htmlEscape = (s='') => String(s).replace(/[&<>"]/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));
    function tweakCloudinary(url){
  try{
    const u = new URL(url);
    // ÙÙ‚Ø· Cloudinary
    if (u.hostname.includes('res.cloudinary.com') && u.pathname.includes('/upload/')){
      // ØµÙˆØ±Ø© ØµØºÙŠØ±Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ÙƒØ±Øª (Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© 68px)
      u.pathname = u.pathname.replace(
        '/upload/',
        '/upload/f_auto,q_auto,w_160,h_160,c_fill,g_face/'
      );
      return u.toString();
    }
  } catch(_) {}
  return url;
}

    function assetPath(u){
      u = (u||'').toString().trim();
     if (/^data:image\//i.test(u)) {
    const MAX_DATA = 900000; // ~0.9MB (ØºÙŠÙ‘Ø±Ù‡Ø§ Ø¥Ø°Ø§ ØªØ­Ø¨)
    return u.length <= MAX_DATA ? u : '/public/assets/contractors/default.jpg';
  }
if (/^https?:\/\//i.test(u)) return tweakCloudinary(u);

      u = u.replace(/\\/g,'/').replace(/^\/?Public\//,'/public/').replace(/\/assests\//gi,'/assets/');
      if (u.startsWith('/uploads/') || u.startsWith('/public/')) return u;
      if (u.startsWith('/assets/')) return '/public'+u;
      if (u.startsWith('/')) return '/public'+u;
      return '/uploads/'+u;
    }
async function compressDataUrlToBlobUrl(dataUrl, size = 160, quality = 0.72){
  // ÙŠÙ‚Ø¨Ù„ data:image ÙÙ‚Ø·
  if (!/^data:image\//i.test(dataUrl)) return dataUrl;

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
  const img = new Image();
  img.decoding = 'async';

  const loaded = new Promise((resolve, reject) => {
    img.onload = () => resolve();
    img.onerror = reject;
  });
  img.src = dataUrl;
  await loaded;

  // Canvas Ù…Ø±Ø¨Ø¹
  const canvas = document.createElement('canvas');
  canvas.width = size;
  canvas.height = size;
  const ctx = canvas.getContext('2d', { alpha: false });

  // Ù‚ØµÙ‘ Ù…Ø±ÙƒØ²ÙŠ cover
  const iw = img.naturalWidth || img.width;
  const ih = img.naturalHeight || img.height;
  const s = Math.min(iw, ih);
  const sx = Math.floor((iw - s) / 2);
  const sy = Math.floor((ih - s) / 2);

  ctx.drawImage(img, sx, sy, s, s, 0, 0, size, size);

  const blob = await new Promise(resolve =>
    canvas.toBlob(resolve, 'image/jpeg', quality)
  );
  if (!blob) return dataUrl;

  return URL.createObjectURL(blob);
}

// Ø·Ø¨Ù‘Ù‚ Ø§Ù„Ø¶ØºØ· ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© (Ù…Ø«Ù„Ø§Ù‹ Ø£ÙˆÙ„ 12 ØµÙˆØ±Ø©)
async function compressVisibleAvatars(max = 12){
  const imgs = Array.from(document.querySelectorAll('.contractor-card .avatar img'))
    .slice(0, max);

  for (const el of imgs){
    const src = el.getAttribute('src') || '';
    if (/^data:image\//i.test(src)) {
      try{
        const blobUrl = await compressDataUrlToBlobUrl(src, 160, 0.72);
        el.src = blobUrl;
      }catch(_){}
    }
  }
}

    const form       = $('#contractor-filters');
    const listWrap   = $('#contractorsWrapper');
    const vipSection = $('#vip-contractors');
    const vipWrap    = $('#vipContractorsWrapper');

 function contractorSlide(c){
   const avatarRaw = (c.avatar && String(c.avatar).trim()) ? String(c.avatar).trim() : '';

  const photos = Array.isArray(c.photos) ? c.photos : [];
  // âœ… Ø®Ø° Ø£ÙˆÙ„ ØµÙˆØ±Ø© Ø£Ø¹Ù…Ø§Ù„ Ù„ÙŠØ³Øª data: (Ø­ØªÙ‰ Ù„Ø§ Ù†Ø±Ø¬Ø¹ base64 Ø¶Ø®Ù…)
  const firstWork = photos.find(p => p && !/^data:/i.test(String(p))) || '';

  const chosen = avatarRaw || firstWork || '/public/assets/contractors/default.jpg';
  const img = /^data:/i.test(chosen) ? chosen : assetPath(chosen);

  const name  = htmlEscape(c.name || 'â€”');
  const spec  = htmlEscape(Array.isArray(c.services) ? c.services.join('ØŒ ') : (c.services||'â€”'));
  const reg   = htmlEscape(c.region || 'â€”');

  // â† Ø·Ø¨Ù‘Ø¹ Ø§Ù„Ø®Ø·Ø© Ø«Ù… Ù‚Ø±Ù‘Ø± Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø±Ø©
  const tierRaw = (c.userTier || c.subscriptionTier || 'Basic');
  const tier    = String(tierRaw);
  const showBadge = tier.toLowerCase() !== 'basic';
  const badgeHTML = showBadge ? `<span class="tier-badge">${tier}</span>` : '';

  const rating= Number(c.ratingAvg||0).toFixed(2);
  const rcnt  = Number(c.ratingCount||0);

  return `
    <div class="swiper-slide">
      <article class="contractor-card">
        ${badgeHTML}
        <div class="card-row">
          <div class="avatar"><img src="${img}" alt="ØµÙˆØ±Ø© ${name}" loading="lazy" onerror="this.onerror=null;this.src='/Public/assets/contractors/default.jpg'"></div>
          <div class="info-stack">
            <h3 class="name">${name}</h3>
            <p class="specialization">${spec}</p>
            <p class="region">${reg}</p>
          </div>
        </div>
        <div class="rating"><small>(${rcnt})</small><span>${rating}</span><span>â­</span></div>
        <a class="card-cta" href="/contractor/${c._id}">ØµÙØ­Ø© Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</a>
      </article>
    </div>`;
}


    function vipSlide(c){
    return contractorSlide(c);

    }

    async function fetchJSON(url){
      const r = await fetch(url, { headers: { 'Accept':'application/json' }});
      if (!r.ok) throw new Error('HTTP '+r.status);
      const j = await r.json();
      return j.data || j.rows || [];
    }

    let allContractors = [];
    let vipOnlyList    = [];
    let nonVipList     = []; 
    let listSwiper = null, vipSwiper = null;

    function destroySwiper(sw){ if (sw) try{ sw.destroy(true,true); }catch(_){ } }
function initListSwiper(){
  // âœ… Ø§Ù†ØªØ¸Ø± Swiper Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­Ù…Ù‘Ù„ Ø¨Ø¹Ø¯
  if (typeof window.Swiper === 'undefined') {
    setTimeout(initListSwiper, 60);
    return;
  }
  destroySwiper(listSwiper);
  listSwiper = new Swiper('.contractor-swiper', {
    watchOverflow: true,

    // âœ… Ù…Ø«Ù„ ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¹: Ù„Ø§ ØªØ­Ù…Ù„ Ø§Ù„ØµÙˆØ± Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
    preloadImages: false,
    lazy: { loadPrevNext: true, loadPrevNextAmount: 2 },
    watchSlidesProgress: true,

    pagination: { el: '.contractor-swiper .swiper-pagination', clickable: true },
    navigation: { nextEl: '.contractor-swiper .swiper-button-next', prevEl: '.contractor-swiper .swiper-button-prev' },
    breakpoints: {
      0:    { slidesPerView: 2.02, spaceBetween: 10 },
      480:  { slidesPerView: 2.10, spaceBetween: 12 },
      640:  { slidesPerView: 2.4,  spaceBetween: 14 },
      1024: { slidesPerView: 3.2,  spaceBetween: 18 },
      1280: { slidesPerView: 4.0,  spaceBetween: 20 }
    }
  });
}

 function initVipSwiper(){
  if (typeof window.Swiper === 'undefined') {
    setTimeout(initVipSwiper, 60);
    return;
  }
  destroySwiper(vipSwiper);
  vipSwiper = new Swiper('.vip-swiper', {
    watchOverflow: true,
    preloadImages: false,
    lazy: { loadPrevNext: true, loadPrevNextAmount: 2 },
    watchSlidesProgress: true,

    pagination: { el: '.vip-swiper .swiper-pagination', clickable: true },
    navigation: { nextEl: '.vip-swiper .swiper-button-next', prevEl: '.vip-swiper .swiper-button-prev' },
    breakpoints: {
      0:    { slidesPerView: 2.02, spaceBetween: 10 },
      480:  { slidesPerView: 2.10, spaceBetween: 12 },
      640:  { slidesPerView: 2.4,  spaceBetween: 14 },
      1024: { slidesPerView: 3.2,  spaceBetween: 18 },
      1280: { slidesPerView: 4.0,  spaceBetween: 20 }
    }
  });
}


    function renderList(list){
      listWrap.innerHTML = (list&&list.length) ? list.map(contractorSlide).join('') : `<div class="empty muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`;
      initListSwiper();
      compressVisibleAvatars(12);
    }
    function renderVip(list){
      const has = Array.isArray(list) && list.length>0;
      vipSection.hidden = !has;
      vipWrap.innerHTML = has ? list.map(vipSlide).join('') : '';
      if (has) initVipSwiper(); else destroySwiper(vipSwiper);
        compressVisibleAvatars(12);
    }

   function applyFilters(){
  const qSpec = (form?.specialization?.value || '').trim().toLowerCase();
  const qCity = (form?.city?.value || '').trim().toLowerCase();

  const pass = (c) => {
    // Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù‚Ø¯ ØªÙƒÙˆÙ† Array Ø£Ùˆ Ù†Øµ
    const spec = (Array.isArray(c.services) ? c.services.join('ØŒ ') : (c.services || '')).toString().toLowerCase();
    // Ù†Ø¹ØªÙ…Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù…Ù† Ø­Ù‚Ù„ city (ÙˆÙ„ÙŠØ³ region)
    const city = (c.city || '').toString().toLowerCase();

    const okSpec = !qSpec || spec.includes(qSpec);
    const okCity = !qCity || city.includes(qCity);
    return okSpec && okCity;
  };

  renderList(nonVipList.filter(pass));
  renderVip(vipOnlyList.filter(pass));
}


    (async function init(){
     const ssr = <%- JSON.stringify((typeof contractors!=='undefined' && Array.isArray(contractors)) ? contractors : []) %>;
allContractors = ssr;

//requestIdleCallback(async () => {
 // try {
   //const first = await fetchJSON('/api/contractors?limit=60');
// Ø­Ù…Ù‘Ù„ Ø£ÙƒØ«Ø± Ù„Ø§Ø­Ù‚Ù‹Ø§
  //  allContractors = Array.isArray(first) ? first : allContractors;

    // Ø­Ø¶Ù‘Ø± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ­Ø¯Ø« Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
    //vipOnlyList = allContractors.filter(c => (c.subscriptionTier||'') === 'VIP');
  //  nonVipList  = allContractors.filter(c => ((c.userTier || c.subscriptionTier || 'Basic') !== 'VIP'));
   // renderList(nonVipList);
    //renderVip(vipOnlyList);
 // } catch(_) {}
//});

      try {
        vipOnlyList = allContractors.filter(c => (c.subscriptionTier||'') === 'VIP');

      } catch(_) {
        vipOnlyList = allContractors.filter(c => (c.subscriptionTier||'') === 'VIP');
      }

      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶: VIP Ø«Ù… Premium Ø«Ù… Basic
      const rank = { VIP:0, Premium:1, Basic:2 };
     // allContractors.sort((a,b)=>(rank[a.subscriptionTier||'Basic']??9)-(rank[b.subscriptionTier||'Basic']??9));

      // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±ØªÙŠØ¨:
//nonVipList = allContractors.filter(c => ((c.userTier || c.subscriptionTier || 'Basic') !== 'VIP'));

// Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø¹Ø§Ù… ÙŠØ¹Ø±Ø¶ ØºÙŠØ± Ø§Ù„Ù€ VIP ÙÙ‚Ø·
//renderList(nonVipList);

// Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ù€ VIP ÙƒÙ…Ø§ Ù‡Ùˆ
//renderVip(vipOnlyList);
// 1) Ø§Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ SSR ÙˆÙ„Ø§ ØªØ¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡ DOM
initListSwiper();
compressVisibleAvatars(12);

// 2) VIP section (Ù„Ùˆ ØªØ±ÙŠØ¯) Ø§ØªØ±ÙƒÙ‡ Ù…Ø®ÙÙŠÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§ØŒ Ø£Ùˆ Ø§Ù…Ù„Ø£Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙÙŠ idle
// vipSection.hidden = true;

// 3) Ø¬Ù‡Ø² allContractors Ù…Ù† SSR Ù„Ù„ÙÙ„ØªØ±Ø© ÙÙ‚Ø·
vipOnlyList = allContractors.filter(c => (c.subscriptionTier||'') === 'VIP');
nonVipList  = allContractors.filter(c => ((c.userTier || c.subscriptionTier || 'Basic') !== 'VIP'));


    if (form){
  form.addEventListener('submit', e=>{ e.preventDefault(); applyFilters(); });
  // Ø§Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙ‘Ø± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø£ÙŠØ¶Ù‹Ø§
  $$('#contractor-filters select').forEach(sel => sel.addEventListener('change', applyFilters));
}

    })();
     // Ø¬Ø¹Ù„ Ø¯ÙˆØ§Ù„ Ø§Ù„ÙÙ„ØªØ±Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø­Ø§Ø±Ø³:
  window.applyFilters = applyFilters;
  window.setContractorFilters = (spec, city) => {
    const form = document.getElementById('contractor-filters');
    if (form) {
      if (form.specialization) form.specialization.value = spec || '';
      if (form.city)           form.city.value           = city || '';
    }
    applyFilters();
  };
  </script>
 <script>
/* ======== Contractor Gate â€” ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ reload/navigate ÙÙ‚Ø·ØŒ ÙˆÙ„Ø§ ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ ======== */
(function(){
  var gate     = document.getElementById('contractor-gate');
  var gateSpec = document.getElementById('gate-spec');
  var gateCity = document.getElementById('gate-city');
  var btnApply = document.getElementById('gate-apply');

  // Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙÙ„Ø§ØªØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©
  var filterForm = document.getElementById('contractor-filters');
  var filterSpec = filterForm ? filterForm.querySelector('#specialization') : null;
  var filterCity = filterForm ? filterForm.querySelector('#city') : null;

  function openGate(){ if (gate) gate.setAttribute('aria-hidden','false'); }
  function closeGate(){ if (gate) gate.setAttribute('aria-hidden','true'); } // âœ… Ø¨Ø¯ÙˆÙ† localStorage

  function navType(){
    // Ø­Ø¯ÙŠØ«
    try{
      if (window.performance && performance.getEntriesByType){
        var nav = performance.getEntriesByType('navigation');
        if (nav && nav[0] && nav[0].type) return nav[0].type; // navigate | reload | back_forward
      }
    }catch(e){}

    // Ù‚Ø¯ÙŠÙ…
    try{
      if (window.performance && performance.navigation){
        var t = performance.navigation.type; // 0,1,2
        if (t === 1) return 'reload';
        if (t === 2) return 'back_forward';
      }
    }catch(e){}

    return 'navigate';
  }

  // Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©/Ø²Ø± Ã—/ØªØ®Ø·Ù‘ÙŠ
  document.addEventListener('click', function(e){
    var t = e.target;
    if (!t) return;
    if (t.dataset && t.dataset.close) return closeGate();
    if (t.classList && t.classList.contains('gate-backdrop')) return closeGate();
  });

  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± â†” ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙ„Ø§ØªØ± â†” ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ„ØªØ±Ø©
  if (btnApply){
    btnApply.addEventListener('click', function(){
      var s = (gateSpec && gateSpec.value ? gateSpec.value : '').trim();
      var c = (gateCity && gateCity.value ? gateCity.value : '').trim();

      if (filterSpec) filterSpec.value = s;
      if (filterCity) filterCity.value = c;

      if (window.setContractorFilters) window.setContractorFilters(s, c);
      else if (window.applyFilters) window.applyFilters();

      closeGate();

      var results = document.getElementById('results');
      if (results && results.scrollIntoView) {
        results.scrollIntoView({ behavior:'smooth', block:'start' });
      }
    });
  }

  // âœ… Ø§ÙØªØ­ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯: ÙØªØ­ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Reload
  window.addEventListener('DOMContentLoaded', function(){
    var t = navType();
    if (t === 'back_forward') return; // Ø±Ø¬ÙˆØ¹ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„: Ù„Ø§ ØªÙØªØ­
    openGate(); // navigate Ø£Ùˆ reload: Ø§ÙØªØ­ Ø¯Ø§Ø¦Ù…Ù‹Ø§
  });

  // âœ… Ù„Ùˆ Ø±Ø¬Ø¹ Ù…Ù† BFCache: Ù„Ø§ Ù†ÙØªØ­Ù‡Ø§
  window.addEventListener('pageshow', function(e){
    if (e && e.persisted) closeGate();
    if (navType() === 'back_forward') closeGate();
  });

})();
</script>


  <%- include('partials/mobile-nav', { 
  activeTab: 'contractors',   // ØºÙŠÙ‘Ø±Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©: 'home' | 'sale' | 'rent' | 'contractors' | 'dash'
  isAuth, isAdmin, isContractor, isOwner,
}) %>
</body>
</html>
