<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ â€” Ø£Ø±Ø§Ø¶ÙŠ + Ø®Ø±ÙŠØ·Ø© + Ø±ÙØ¹ ØµÙˆØ± + Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ</title>
  <meta name="description" content="Ù„ÙˆØ­Ø© Ù…Ø§Ù„Ùƒ Ø§Ù„Ø£Ø±Ø¶ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© OpenStreetMap Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ·Ù„Ø¨ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous"/>

  <style>
    :root{
      --g700:#047857; --g600:#059669; --y500:#eab308;
      --ink:#0f172a; --ink70:#334155; --ink50:#64748b;
      --bg:#f7faf7; --ring:0 0 0 3px rgba(5,150,105,.28);
      --sh1:0 10px 26px rgba(2,44,34,.10);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(#f7fff8,#fbfdf6);color:var(--ink);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .container{width:min(1180px,92%);margin-inline:auto}
    .topbar{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid #e5e7eb;z-index:10}
    .topbar__inner{display:flex;justify-content:space-between;align-items:center;padding:.8rem 0}
    .brand{display:flex;gap:.6rem;align-items:center;font-weight:900}
    .brand__mark{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;color:#fff;background:linear-gradient(135deg,var(--g600),var(--y500))}
    .btn{display:inline-flex;align-items:center;gap:.4rem;padding:.6rem .9rem;border-radius:12px;border:1px solid #d1d5db;background:#fff;font-weight:800;cursor:pointer}
    .btn--primary{background:linear-gradient(135deg,var(--g600),var(--g700));color:#fff;border-color:transparent;box-shadow:0 10px 24px rgba(4,120,87,.2)}
    .btn--small{padding:.45rem .65rem}
    .btn--ghost{background:#fff}
    .btn--danger{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;border-color:transparent}
    .btn--outline{background:#fff;border-color:#d1d5db}
    .input{width:100%;padding:.6rem .8rem;border:1px solid #e2e8f0;border-radius:12px;background:#fff}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:1rem;margin:1rem 0}
    .sidebar{border:1px solid #e2e8f0;border-radius:16px;background:#fff;box-shadow:var(--sh1)}
    .menu{display:grid;padding:.6rem}
    .menu__item{padding:.65rem .75rem;border-radius:12px;text-align:right;font-weight:800}
    .menu__item.is-active{background:linear-gradient(135deg,var(--g600),var(--g700));color:#fff}
    .content{min-width:0}
    .panel{display:none;border:1px solid #e2e8f0;border-radius:16px;background:#fff;box-shadow:var(--sh1);padding:1rem}
    .panel.is-visible{display:block}
    .panel__head{display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem}
    .grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.8rem}
    .form{display:grid;gap:.75rem}
    .field{display:grid;gap:.3rem}
    .field--full{grid-column:1/-1}
    .label{font-weight:800;color:var(--ink70)}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap}
    .cards{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.8rem}
    .land{border:1px solid #e5e7eb;border-radius:16px;background:#fff;display:grid;grid-template-columns:140px 1fr;gap:.8rem;padding:.8rem}
    .land__media{width:140px;height:110px;border-radius:12px;overflow:hidden;background:#0b1a13}
    .land__media img{width:100%;height:100%;object-fit:cover}
    .muted{color:var(--ink50)}
    /* Ø®Ø±ÙŠØ·Ø© */
    .map-wrap{border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;background:#fff}
    .map-toolbar{display:flex;gap:.5rem;flex-wrap:wrap;padding:.6rem;border-bottom:1px solid #e5e7eb;background:#f9fafb}
    #map{width:100%;height:360px}
    .search-results{max-height:160px;overflow:auto;border-top:1px solid #e5e7eb}
    .search-results button{display:block;width:100%;text-align:right;padding:.5rem .75rem;border:0;background:#fff;border-bottom:1px solid #f1f5f9;cursor:pointer}
    .search-results button:hover{background:#f9fafb}
    /* Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Drag & Drop */
    .drop{border:2px dashed #cbd5e1;border-radius:16px;padding:1rem;display:grid;place-items:center;text-align:center;background:#fafafa}
    .drop.is-over{background:#f1f5f9;border-color:#94a3b8}
    .drop__hint{margin:.4rem 0;color:var(--ink50)}
    .thumbs{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:.5rem;margin-top:.6rem}
    .thumb{position:relative;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#0000000a}
    .thumb img{display:block;width:100%;height:110px;object-fit:cover}
    .thumb button{position:absolute;inset:.3rem .3rem auto auto;border:0;border-radius:9px;background:#fff;padding:.2rem .5rem;cursor:pointer}
    .thumb button:hover{background:#ffe7e7}
    .toasts{position:fixed;left:16px;bottom:16px;display:grid;gap:.5rem;z-index:50}
    .toast{padding:.55rem .8rem;border-radius:12px;border:1px solid #e2e8f0;background:#fff;box-shadow:var(--sh1);font-weight:800}
    .toast--ok{border-color:#a7f3d0;background:#ecfdf5;color:#065f46}
    .toast--warn{border-color:#fde68a;background:#fffbeb;color:#92400e}
    @media (max-width:1100px){.thumbs{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:900px){.layout{grid-template-columns:1fr}.grid2{grid-template-columns:1fr}.thumbs{grid-template-columns:repeat(3,1fr)}#map{height:300px}}
    :focus-visible{outline:none;box-shadow:var(--ring);border-radius:10px}
    #map { cursor: crosshair; }

  </style>
</head>
<body>
<%- include('partials/navbar') %>

  <main class="container layout">
    <aside class="sidebar">
      <nav class="menu">
        <button class="menu__item is-active" data-view="lands">Ø£Ø±Ø§Ø¶ÙŠÙ‘ÙŠ</button>
        <button class="menu__item" data-view="new">Ø¥Ø¶Ø§ÙØ© Ø£Ø±Ø¶</button>
        <button class="menu__item" data-view="subscribe">Ø·Ù„Ø¨ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
        <button class="menu__item" data-view="settings" style="display: none;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </nav>
    </aside>

    <section class="content">
      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ -->
      <section class="panel is-visible" id="view-lands">
        <header class="panel__head"><h2>Ø£Ø±Ø§Ø¶ÙŠÙ‘ÙŠ</h2></header>
        <div id="landsList" class="cards"></div>
        <p id="landsEmpty" class="muted" hidden>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ø§Ø¶Ù.</p>
      </section>

      <!-- Ø¥Ø¶Ø§ÙØ© Ø£Ø±Ø¶ + Ø®Ø±ÙŠØ·Ø© + Ø±ÙØ¹ ØµÙˆØ± + Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø§Ù„Ùƒ -->
      <section class="panel" id="view-new">
        <header class="panel__head"><h2 id="formTitle">Ø¥Ø¶Ø§ÙØ© Ø£Ø±Ø¶</h2></header>

        <form id="landForm" class="form grid2" action="/owner/lands" method="post" novalidate>
          <input type="hidden" name="id"/>

          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„Ùƒ -->
          <label class="field"><span class="label">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</span><input maxlength="50" name="ownerFirst" class="input" placeholder="Ø§Ù„Ø§Ø³Ù…"/></label>
          <label class="field"><span class="label">Ø§Ù„Ù„Ù‚Ø¨</span><input maxlength="50" name="ownerLast" class="input" placeholder="Ø§Ù„Ù„Ù‚Ø¨"/></label>
          <label class="field"><span class="label">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨</span><input name="ownerWhatsapp" class="input" placeholder="+9665... Ø£Ùˆ +9639..." /></label>

          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø±Ø¶ -->
          <label class="field"><span class="label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</span><input name="title" class="input" required placeholder="Ù…Ø«Ø§Ù„: Ù…Ø²Ø±Ø¹Ø© Ø²ÙŠØªÙˆÙ†"/></label>
          <label class="field"><span class="label">Ø§Ù„Ù†ÙˆØ¹</span>
            <select name="kind" class="input"><option value="sale">Ø¨ÙŠØ¹</option><option value="rent">Ø¥ÙŠØ¬Ø§Ø±</option></select>
          </label>
          <label class="field"><span class="label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span><input name="area" class="input" required/></label>
          <label class="field">
  <span class="label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</span>
  <select name="city" class="input" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©â€¦</option>
    <option>Ø¯Ù…Ø´Ù‚</option>
    <option>Ø±ÙŠÙ Ø¯Ù…Ø´Ù‚</option>
    <option>Ø­Ù„Ø¨</option>
    <option>Ø­Ù…Øµ</option>
    <option>Ø­Ù…Ø§Ø©</option>
    <option>Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©</option>
    <option>Ø·Ø±Ø·ÙˆØ³</option>
    <option>Ø¥Ø¯Ù„Ø¨</option>
    <option>Ø¯ÙŠØ± Ø§Ù„Ø²ÙˆØ±</option>
    <option>Ø§Ù„Ø­Ø³ÙƒØ©</option>
    <option>Ø§Ù„Ø±Ù‚Ø©</option>
    <option>Ø¯Ø±Ø¹Ø§</option>
    <option>Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©</option>
    <option>Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡</option>
  </select>
</label>
          <label class="field"><span class="label">Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)</span><input name="size" type="number" class="input" min="0" required/></label>
          <label class="field"><span class="label">Ø§Ù„Ø³Ø¹Ø±</span><input name="price" type="number" class="input" min="0" required/></label>
<label class="field">
  <span class="label">Ø§Ù„Ø¹Ù…Ù„Ø©</span>
  <select name="currency" class="input" required>
    <option value="USD">$ Ø¯ÙˆÙ„Ø§Ø±</option>
    <option value="SYP">Ù„.Ø³ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</option>
  </select>
</label>
<label class="field" id="rentPeriodField" style="display:none">
  <span class="label">Ù†ÙˆØ¹ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</span>
  <select name="rentPeriod" class="input">
    <option value="monthly">Ø¥ÙŠØ¬Ø§Ø± Ø´Ù‡Ø±ÙŠ</option>
    <option value="daily">Ø¥ÙŠØ¬Ø§Ø± ÙŠÙˆÙ…ÙŠ</option>
  </select>
</label>

          <!-- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª -->
          <div class="field field--full">
            <span class="label">ØµÙˆØ± Ø§Ù„Ø£Ø±Ø¶</span>
            <div id="drop" class="drop" tabindex="0" aria-label="Ù…Ù†Ø·Ù‚Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±">
              <div>
                <strong>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§</strong>
                <div class="drop__hint">Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ (ÙŠØ¯Ø¹Ù… ØµÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©)</div>
                <button type="button" class="btn btn--ghost btn--small" id="pickBtn">Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±</button>
                <input id="fileInput" type="file" accept="image/*" multiple hidden>
              </div>
            </div>
            <div id="thumbs" class="thumbs" aria-live="polite"></div>
            <small class="muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.</small>
          </div>
<!-- Ø¯Ø§Ø®Ù„ <form id="landForm" ...> ÙˆÙ‚Ø¨Ù„ Ø§Ù„ÙˆØµÙ Ø§Ù„Ø¹Ø§Ù… -->
<label class="field field--full">
  <span class="label">ÙˆØµÙ Ø§Ù„Ù…Ø³Ø¨Ø­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
  <textarea name="poolDesc" maxlength="500" class="input" rows="3" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø¨Ø­: Ø§Ù„Ø­Ø¬Ù…/Ø§Ù„ØªØ¬Ù‡ÙŠØ²/Ø§Ù„Ø³Ù„Ø§Ù…Ø©â€¦"></textarea>
</label>

<label class="field field--full">
  <span class="label">ÙˆØµÙ Ø§Ù„Ù…Ø±Ø§ÙÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
  <textarea name="amenitiesDesc" maxlength="500" class="input" rows="3" placeholder="Ù…Ø±Ø§ÙÙ‚ ÙˆØ®Ø¯Ù…Ø§Øª â€¦"></textarea>
</label>

<label class="field field--full">
  <span class="label">ÙˆØµÙ Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
  <textarea name="buildingDesc" class="input" maxlength="500" rows="3" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù†Ø§Ø¡ â€¦"></textarea>
</label>

          <!-- ÙˆØµÙ -->
          <label class="field field--full"><span class="label">ÙˆØµÙ</span><textarea name="desc" maxlength="2000" class="input" rows="4"></textarea></label>
      <!-- Ø¯Ø§Ø®Ù„ <form id="landForm" ...> -->
<label class="field field--full">
  <span class="label">Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
  <input name="videoUrl" class="input" placeholder="https://youtu.be/xxxx Ø£Ùˆ Ø±Ø§Ø¨Ø· mp4" />
</label>
          <!-- Ø®Ø±ÙŠØ·Ø© -->
          <div class="field field--full">
            <span class="label">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© (OpenStreetMap)</span>
            <div class="map-wrap">
              <div class="map-toolbar">
                <input id="placeSearch" class="input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø«Ù… Ø§Ø¶ØºØ· Ø¨Ø­Ø«"/>
                <button type="button" class="btn btn--small" id="searchBtn">Ø¨Ø­Ø«</button>
                <button type="button" class="btn btn--small" id="useGeoloc">Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
                <button type="button" class="btn btn--small" id="clearLocation">Ù…Ø³Ø­ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
              </div>
              <div id="map"></div>
              <div id="results" class="search-results" hidden></div>
            </div>
            <input type="hidden" name="lat"/>
            <input type="hidden" name="lng"/>
            <input type="hidden" name="address"/>
            <small class="muted">Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø³Ù†Ø­ÙØ¸ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</small>
          </div>

          <div class="actions field--full">
            <button class="btn btn--primary" type="submit">Ø­ÙØ¸ ÙˆØ§Ø±Ø³Ø§Ù„</button>
          </div>
        </form>
      </section>

      <!-- Ù„ÙˆØ­Ø© Ø·Ù„Ø¨ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
      <section class="panel" id="view-subscribe">
        <header class="panel__head"><h2>Ø·Ù„Ø¨ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h2></header>

        <form id="subscribeForm" class="form" novalidate>
          <div class="field">
            <span class="label">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·Ø©</span>
            <select name="plan" class="input" required>
              <option value="Premium">Premium</option>
              <option value="VIP">VIP</option>
            </select>
          </div>

          <div class="grid2">
            <label class="field">
              <span class="label">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</span>
              <input class="input" maxlength="50" name="ownerFirst" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
            </label>
            <label class="field">
              <span class="label">Ø§Ù„Ù„Ù‚Ø¨</span>
              <input class="input" maxlength="50" name="ownerLast" placeholder="Ø§Ù„Ù„Ù‚Ø¨" required>
            </label>
          </div>

          <label class="field">
            <span class="label">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„</span>
            <input class="input" name="ownerWhatsapp" placeholder="+963XXXXXXXXXX" required>
            <small class="muted">Ø³Ù†Ø¶Ù…Ù‘Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø±Ø¯Ù‘ Ø¹Ù„ÙŠÙƒ.</small>
          </label>


          <label class="field">
            <span class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
            <textarea class="input" maxlength="500" name="notes" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø±ØºØ¨ Ø¨Ø¹Ø¯Ø¯ X Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø§ØªØµØ§Ù„..."></textarea>
          </label>
        
          <div class="actions">
            <button class="btn btn--primary" type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
            <button class="btn btn--outline" type="button" id="prefillBtn">ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ù† Ø¢Ø®Ø± Ø¥Ø¹Ù„Ø§Ù†</button>
          </div>

          <small class="muted">Ø³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ù…ØªØµÙØ­Ùƒ Ø¨Ø±Ø³Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø© Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©.</small>
        </form>
      </section>

      <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…Ø®ØªØµØ±Ø©) -->
      <section class="panel" id="view-settings">
        <header class="panel__head"><h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2></header>
        <p class="muted">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø®ØªØµØ±Ø© â€” Ù„Ù„ØªØ¬Ø±Ø¨Ø©.</p>
      </section>
    </section>
  </main>

  <!-- Toasts -->
  <div id="toasts" class="toasts"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <script>
    (()=> {
      'use strict';
      const qs=(s,r=document)=>r.querySelector(s);
      const qsa=(s,r=document)=>Array.from(r.querySelectorAll(s));
      const toastBox = qs('#toasts');
      const list  = document.getElementById('landsList');
      const empty = document.getElementById('landsEmpty');
      let _quotaState = { plan: 'Basic', left: 0, unlimited: false };
      let _quotaReady = false; // Ø¬Ø¯ÙŠØ¯

      function toast(msg, kind='ok', ms=2200){
        const t=document.createElement('div');
        t.className='toast ' + (kind==='ok'?'toast--ok':'toast--warn');
        t.textContent=msg; toastBox.appendChild(t);
        setTimeout(()=>t.remove(), ms);
      }
      function esc(s){ return (s??'').toString().replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

      // ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯
      const views={ lands:qs('#view-lands'), new:qs('#view-new'), subscribe:qs('#view-subscribe'), settings:qs('#view-settings') };
      qsa('.menu__item').forEach(btn=>{
        btn.addEventListener('click',async  ()=>{
          qsa('.menu__item').forEach(b=>b.classList.remove('is-active'));
          btn.classList.add('is-active');
          const t=btn.dataset.view;
          Object.entries(views).forEach(([k,v])=> v.classList.toggle('is-visible', k===t));
          if (t==='new') {
      _quotaReady = false;                    // Ø£Ø¹Ø¯ Ø§Ù„Ø¶Ø¨Ø· Ø¹Ù†Ø¯ ÙƒÙ„ Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ¨ÙˆÙŠØ¨
      await refreshQuota();                   // Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­ØµÙ‘Ø©
      setTimeout(()=> map?.invalidateSize(), 100);
    }
          //if (t==='subscribe') prefillSubscribe();
        });
      });

      // Ø¨ÙŠØ§Ù†Ø§Øª
      const LS_KEY='owner_leaflet_uploads_v2_subscribe';
      const state = load() || seed();
      function load(){ try{const x=localStorage.getItem(LS_KEY); return x?JSON.parse(x):null;}catch{return null} }
      function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
      function seed(){
  return { lands: [] };
 }
      // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ
    
     // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ â€” Ù„Ø§ Ù…Ø´ÙƒÙ„Ø© Ù„Ùˆ ÙƒØ§Ù†Øª Ù…ÙƒØ±Ø±Ø©)
  
  // Ø§Ø¬Ù„Ø¨ Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± (JSON)
  async function fetchMyLands(){
    const res = await fetch('/owner/lands', { headers:{ 'Accept':'application/json' } });
    if (!res.ok) throw new Error('fetch error');
    const json = await res.json();
    if (!json.ok) throw new Error(json.msg || 'fetch error');
    return json.data || [];
  }

  // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
  function fmt(n){ try { return new Intl.NumberFormat('en').format(Number(n)||0); } catch { return n; } }

  // â¬…ï¸ Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© renderLands Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø©
  async function renderLands(){
    
    list.innerHTML = '';
    let rows = [];
    try { rows = await fetchMyLands(); } catch { rows = []; }
window.__myLands = rows; // â† Ù†Ø®Ø²Ù‘Ù† Ø¢Ø®Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ù…Ø§Ù„Ùƒ
    if (!rows.length){ empty.hidden = false; return; }
    empty.hidden = true;

    rows.forEach(l=>{
      const cover = (Array.isArray(l.photos) && l.photos[0]) || 'https://images.unsplash.com/photo-1613336026275-d6d0d43688ff?w=800';
      const kindText = l.kind === 'rent' ? 'Ø¥ÙŠØ¬Ø§Ø±' : 'Ø¨ÙŠØ¹';
const symbol   = (l.currency === 'SYP') ? 'Ù„.Ø³' : '$';

// Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ù†Øµ Ø­Ø³Ø¨ rentPeriod
let periodText = '';
if (l.kind === 'rent') {
  periodText = (l.rentPeriod === 'daily') ? '/ÙŠÙˆÙ…' : '/Ø´Ù‡Ø±';
}

const priceText = (l.kind === 'rent')
  ? `${symbol}${fmt(l.price)}${periodText}`
  : `${symbol}${fmt(l.price)}`;

      const loc = l.location
        ? ` â€¢ ğŸ“ ${esc(l.location.address || ((l.location.lat||'')+', '+(l.location.lng||'')))}`
        : '';

     const owner = l.ownerInfo ? ` â€¢ ğŸ‘¤ ${esc(l.ownerInfo.first||'')} ${esc(l.ownerInfo.last||'')}` : '';
const wa = l.ownerInfo?.whatsapp ? ` â€¢ ÙˆØ§ØªØ³Ø§Ø¨: <a href="https://wa.me/${encodeURIComponent((l.ownerInfo.whatsapp||'').replace(/\D/g,''))}" target="_blank" rel="noopener">ØªÙˆØ§ØµÙ„</a>` : '';
      // Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© + Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ø¥Ù† ÙˆØ¬Ø¯
      let statusBadge = '';
      if (l.status === 'approved')
        statusBadge = `<span class="pill" style="background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;padding:.1rem .45rem;border-radius:999px">Ù…Ù‚Ø¨ÙˆÙ„</span>`;
      else if (l.status === 'rejected')
        statusBadge = `<span class="pill" style="background:#fef2f2;border:1px solid #fecaca;color:#991b1b;padding:.1rem .45rem;border-radius:999px">Ù…Ø±ÙÙˆØ¶</span>`;
      else
        statusBadge = `<span class="pill" style="background:#fffbeb;border:1px solid #fde68a;color:#92400e;padding:.1rem .45rem;border-radius:999px">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>`;

      const reason = (l.status === 'rejected' && l.reviewNote)
        ? `<div class="muted" style="margin-top:.25rem">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶: ${esc(l.reviewNote)}</div>`
        : '';

      const card = document.createElement('article');
card.className = 'land';
card.innerHTML = `
  <div class="land__media"><img src="${cover}" alt=""></div>
  <div>
    <h3 style="margin:.1rem 0">${esc(l.title||'â€”')}</h3>
    <div class="muted">
      ${kindText} â€¢ ${esc(l.area||'')} â€” ${esc(l.city||'')}
      ${loc}${owner}${wa}
      â€¢ ${priceText} â€¢ ${fmt(l.size)} Ù…Â²
    </div>
    <div style="margin-top:.35rem">${statusBadge}</div>
    ${reason}
    <div style="margin-top:.5rem; display:flex; gap:.4rem; flex-wrap:wrap">
     <button class="btn btn--outline btn--small" data-act="edit" data-id="${l._id}">ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="btn btn--danger btn--small" data-act="delete" data-id="${l._id}">Ø­Ø°Ù</button>
    </div>
  </div>
`;
list.appendChild(card);

    });
  }

  // Ø§Ø³ØªØ¯Ø¹Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© (ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£ØµÙ„Ù‹Ø§ ÙÙŠ Ù…Ù„ÙÙƒØ› Ø£Ø¨Ù‚Ù Ø§Ù„Ù†Ø¯Ø§Ø¡)
 
// Ø§Ø³ØªØ¯Ø¹Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
renderLands();

// Ø£Ø²Ø±Ø§Ø± ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
list.addEventListener('click', async (e)=>{
  const btn = e.target.closest('button[data-act]');
  if (!btn) return;

  const id  = btn.dataset.id;
  const act = btn.dataset.act;

  if (act === 'edit') {
    try{
       const res  = await fetch(`/owner/lands/${id}`, { headers:{ 'Accept':'application/json' } });
      if (!res.ok) { toast('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØµÙ„Ø§Ø­ÙŠØªÙƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ©','warn'); return; }
      const json = await res.json();
      if (!json.ok) { toast(json.msg || 'ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†','warn'); return; }

      const l = json.data;

      const form = document.getElementById('landForm');
      form.querySelector('[name="id"]').value            = l._id || '';
      form.querySelector('[name="ownerFirst"]').value    = l.ownerInfo?.first || '';
      form.querySelector('[name="ownerLast"]').value     = l.ownerInfo?.last || '';
      form.querySelector('[name="ownerWhatsapp"]').value = l.ownerInfo?.whatsapp || '';
      form.querySelector('[name="title"]').value         = l.title || '';
      form.querySelector('[name="kind"]').value          = (l.kind === 'rent' ? 'rent' : 'sale');
      form.querySelector('[name="area"]').value          = l.area || '';
      form.querySelector('[name="city"]').value          = l.city || '';
      form.querySelector('[name="size"]').value          = Number(l.size || 0);
      form.querySelector('[name="price"]').value         = Number(l.price || 0);
      form.querySelector('[name="currency"]').value = (l.currency === 'SYP' ? 'SYP' : 'USD');
 const rentSel = form.querySelector('[name="rentPeriod"]');
if (rentSel) {
  rentSel.value = (l.rentPeriod === 'daily' ? 'daily' : 'monthly');
}

      form.querySelector('[name="desc"]').value          = l.description || '';
      form.querySelector('[name="videoUrl"]').value      = l.videoUrl || '';
      form.querySelector('[name="poolDesc"]').value      = l.poolDesc || '';
      form.querySelector('[name="amenitiesDesc"]').value = l.amenitiesDesc || '';
      form.querySelector('[name="buildingDesc"]').value  = l.buildingDesc || '';

      // Ø§Ù„ØµÙˆØ±
      pendingPhotos = Array.isArray(l.photos) ? [...l.photos] : [];
      renderThumbs?.();
      toggleRentPeriod?.();

      // Ø§Ù„Ù…ÙˆÙ‚Ø¹
      const lat = Number(l?.location?.lat);
      const lng = Number(l?.location?.lng);
      const address = l?.location?.address || '';
      if (Number.isFinite(lat) && Number.isFinite(lng)) {
        setLocation(lat, lng, address, true);
      } else {
        marker?.setOpacity?.(0);
        document.querySelector('input[name="lat"]').value = '';
        document.querySelector('input[name="lng"]').value = '';
        document.querySelector('input[name="address"]').value = '';
      }

      // Ø§ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      document.querySelectorAll('.menu__item').forEach(b=>b.classList.remove('is-active'));
      document.querySelector('.menu__item[data-view="new"]')?.classList.add('is-active');
      Object.entries(views).forEach(([k,v])=> v.classList.toggle('is-visible', k==='new'));

  const ft1 = document.getElementById('formTitle');
if (ft1) ft1.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø£Ø±Ø¶';

      setTimeout(()=> map?.invalidateSize(), 100);

      toast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† â€” Ø¹Ø¯Ù‘Ù„ Ø«Ù… Ø§Ø­ÙØ¸','ok');
    }catch(err){
      console.error(err);
      toast('ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù„ØªØ¹Ø¯ÙŠÙ„','warn');
    }
    return;
  }

  if (act === 'delete') {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø±Ø¶ØŸ')) return;
    try{
      const res  = await fetch(`/owner/lands/${id}`, { method:'DELETE' });
      const json = await res.json();
      if (!json.ok) throw new Error(json.msg || 'failed');
      toast('ØªÙ… Ø§Ù„Ø­Ø°Ù','ok');
      await renderLands();
      await refreshQuota?.();
    }catch(err){
      console.error(err);
      toast('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø­Ø°Ù','warn');
    }
    return;
  }
});

      // ====== Leaflet + Nominatim ======
      // Ø¥ØµÙ„Ø§Ø­ Ø±ÙˆØ§Ø¨Ø· Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø§Ø±ÙƒØ± (Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† CDN)
      L.Icon.Default.mergeOptions({
        iconRetinaUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
        iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
        shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      });

      const map = L.map('map', { center:[33.5138,36.2765], zoom:8 });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom:19, attribution:'&copy; OpenStreetMap'
      }).addTo(map);

      let marker = L.marker([33.5138,36.2765], {draggable:true}).addTo(map);
      marker.setOpacity(0); // Ù…Ø®ÙÙŠ Ø¥Ù„Ù‰ Ø£Ù† ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙƒØ§Ù†Ù‹Ø§
     // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©: Ø«Ø¨Ù‘Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© ÙˆØ§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„
map.on('click', async (e) => {
  const { lat, lng } = e.latlng;
  // Ø­Ø§ÙˆÙ„ Ù†Ø¬ÙŠØ¨ Ø¹Ù†ÙˆØ§Ù† Ø¨Ù†Ù‚Ø·Ø© Ø¹ÙƒØ³ÙŠØ© (Ø¥Ù† ÙØ´Ù„ØŒ Ù†Ø®Ù„ÙŠÙ‡Ø§ ÙØ§Ø¶ÙŠØ©)
  let addr = '';
  try { addr = await reverseGeocode(lat, lng); } catch {}
  setLocation(lat, lng, addr, true); // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ ÙˆØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ + marker
});

      const latInput = qs('input[name="lat"]');
      const lngInput = qs('input[name="lng"]');
      const addrInput = qs('input[name="address"]');
      const searchInput = qs('#placeSearch');
      const resultsBox = qs('#results');

      function setLocation(lat, lng, address='', pan=true){
        marker.setLatLng([lat,lng]).setOpacity(1);
        if (pan){ map.setView([lat,lng], 14); }
        latInput.value=lat; lngInput.value=lng; addrInput.value=address; searchInput.value=address||searchInput.value;
      }

      marker.on('dragend', ()=>{
        const {lat,lng} = marker.getLatLng();
        latInput.value=lat; lngInput.value=lng;
        reverseGeocode(lat,lng).then(addr=>{
          addrInput.value = addr || '';
          if (addr) searchInput.value = addr;
        });
      });

      qs('#searchBtn').addEventListener('click', ()=> doSearch());
      searchInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); doSearch(); }});
      qs('#useGeoloc').addEventListener('click', useMyLocation);
      qs('#clearLocation').addEventListener('click', ()=>{
        marker.setOpacity(0); latInput.value=''; lngInput.value=''; addrInput.value=''; searchInput.value='';
        toast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…ÙˆÙ‚Ø¹','warn');
      });

      async function doSearch(){
        const q = searchInput.value.trim();
        if (!q) return;
        resultsBox.innerHTML = '<button disabled>Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«â€¦</button>';
        resultsBox.hidden = false;
        try{
          const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=5&q=${encodeURIComponent(q)}`;
          const res = await fetch(url, {headers:{'Accept-Language':'ar'}});
          const data = await res.json();
          if (!data.length){ resultsBox.innerHTML = '<button disabled>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</button>'; return; }
          resultsBox.innerHTML = data.map(p=>(`<button type="button" data-lat="${p.lat}" data-lng="${p.lon}" data-label="${esc(p.display_name)}">${esc(p.display_name)}</button>`)).join('');
        }catch(e){
          resultsBox.innerHTML = '<button disabled>ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¨Ø­Ø«</button>';
        }
      }

      resultsBox.addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-lat]'); if(!btn) return;
        const lat = parseFloat(btn.dataset.lat), lng = parseFloat(btn.dataset.lng);
        const label = btn.dataset.label || '';
        setLocation(lat,lng,label,true);
        resultsBox.hidden = true;
      });

      async function reverseGeocode(lat,lng){
        try{
          const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=16&addressdetails=1`;
          const res = await fetch(url, {headers:{'Accept-Language':'ar'}});
          const data = await res.json();
          return data.display_name || '';
        }catch{ return ''; }
      }

      function useMyLocation(){
        if (!navigator.geolocation){ toast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹','warn'); return; }
        navigator.geolocation.getCurrentPosition(async pos=>{
          const {latitude:lat, longitude:lng} = pos.coords;
          const addr = await reverseGeocode(lat,lng);
          setLocation(lat,lng,addr,true);
        }, ()=> toast('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ','warn'), {enableHighAccuracy:true, timeout:7000});
      }

      // ====== Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± (Drag & Drop + File Input) ======
      const drop = qs('#drop');
      const pickBtn = qs('#pickBtn');
      const fileInput = qs('#fileInput');
      const thumbs = qs('#thumbs');
      // Ù…Ø®Ø²Ù† Ù…Ø¤Ù‚Øª Ù„ØµÙˆØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ (Base64 DataURLs)
      let pendingPhotos = [];
      const MAX_TOTAL_BYTES = 5 * 1024 * 1024; // 5MB

function dataUrlBytes(src){
  if (typeof src !== 'string') return 0;

  // âœ… Ù„Ùˆ Ù„ÙŠØ³Øª data:image (ÙŠØ¹Ù†ÙŠ Ø±Ø§Ø¨Ø· https Ù‚Ø¯ÙŠÙ… Ø¬Ø§Ù‡Ø²) Ù†Ø¹ØªØ¨Ø±Ù‡Ø§ 0
  if (!src.startsWith('data:image')) return 0;

  const i = src.indexOf(',');
  if (i < 0) return 0;

  const b64 = src.slice(i + 1);
  const pad = b64.endsWith('==') ? 2 : b64.endsWith('=') ? 1 : 0;
  return Math.max(0, Math.floor(b64.length * 3 / 4) - pad);
}

      pickBtn.addEventListener('click', ()=> fileInput.click());
      fileInput.addEventListener('change', (e)=> handleFiles(e.target.files));

      // Ø³Ø­Ø¨/Ø¥ÙÙ„Ø§Øª
      ['dragenter','dragover'].forEach(ev=>{
        drop.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add('is-over'); });
      });
      ['dragleave','drop'].forEach(ev=>{
        drop.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove('is-over'); });
      });
      drop.addEventListener('drop', e=>{
        const files = e.dataTransfer.files;
        if (files && files.length) handleFiles(files);
      });

      // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹: Ø§ÙØªØ­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
      drop.addEventListener('click', (e)=> {
        if (e.target.closest('button') || e.target.closest('input')) return;
        fileInput.click();
      });

      function handleFiles(files){
  const arr = Array.from(files).filter(f=> f.type.startsWith('image/'));
  if (!arr.length){ toast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± ÙÙ‚Ø·','warn'); return; }

  // Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (Ù…Ø­ÙÙˆØ¸Ø© ÙƒÙ€ DataURL)
  const existingBytes = (pendingPhotos||[]).reduce((sum,src)=> sum + dataUrlBytes(src), 0);
  // Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„
  const newBytes = arr.reduce((s,f)=> s + (f.size||0), 0);

  if (existingBytes + newBytes > MAX_TOTAL_BYTES){
    toast('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± ÙŠØªØ¬Ø§ÙˆØ² 5MB. Ø±Ø¬Ø§Ø¡Ù‹ Ù‚Ù„Ù‘Ù„ Ø¹Ø¯Ø¯/Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±.', 'warn');
    return;
  }

  // Ù„Ùˆ Ø§Ù„Ø­Ø¯ Ù…Ù…ØªØ§Ø²ØŒ Ø­ÙˆÙ‘Ù„ ÙˆØ£Ø¶ÙÙ
  arr.forEach(file=>{
    const reader = new FileReader();
    reader.onload = ()=>{
      pendingPhotos.push(reader.result); // DataURL
      renderThumbs();
    };
    reader.readAsDataURL(file);
  });
}


      function renderThumbs(){
        thumbs.innerHTML = '';
        pendingPhotos.forEach((src, i)=>{
          const t = document.createElement('div');
          t.className='thumb';
          t.innerHTML = `<img src="${src}" alt=""><button type="button" data-i="${i}">Ø­Ø°Ù</button>`;
          thumbs.appendChild(t);
        });
      }
      thumbs.addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-i]'); if(!btn) return;
        const i = parseInt(btn.dataset.i,10);
        pendingPhotos.splice(i,1);
        renderThumbs();
      });

      // Ø­ÙØ¸ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ø±Ø¶
const landForm = qs('#landForm');
const submitBtnPrimary = landForm?.querySelector('button[type="submit"]');
const defaultLandLabel = submitBtnPrimary?.textContent || 'Ø­ÙØ¸ ÙˆØ§Ø±Ø³Ø§Ù„';
let isLandSubmitting = false;

if (submitBtnPrimary) {
  submitBtnPrimary.disabled = true;            // Ø²Ø± Ù…ØºÙ„Ù‚ Ø¥Ù„Ù‰ Ø£Ù† Ù†Ø¬Ù„Ø¨ Ø§Ù„Ø­ØµÙ‘Ø©
  submitBtnPrimary.title = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­ØµØªÙƒâ€¦';
}


// Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù†ÙˆØ¹ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø­Ø³Ø¨ kind
const kindSelect       = landForm.querySelector('[name="kind"]');
const rentPeriodField  = landForm.querySelector('#rentPeriodField');

function toggleRentPeriod() {
  if (!kindSelect || !rentPeriodField) return;
  if (kindSelect.value === 'rent') {
    rentPeriodField.style.display = '';
  } else {
    rentPeriodField.style.display = 'none';
  }
}

// Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
toggleRentPeriod();

// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù†ÙˆØ¹
if (kindSelect) {
  kindSelect.addEventListener('change', toggleRentPeriod);
}
landForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if (!landForm || !submitBtnPrimary) return;

  // Ù„Ø§ Ù†Ø³Ù…Ø­ Ø¨Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ØªÙƒØ±Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  if (isLandSubmitting) return;

  // 1) ÙØ­Øµ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± (DataURL ÙÙ‚Ø·)
  const totalBytes = (pendingPhotos||[]).reduce((sum,src)=> sum + dataUrlBytes(src), 0);
  if (totalBytes > MAX_TOTAL_BYTES){
    toast('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± ÙŠØªØ¬Ø§ÙˆØ² 5MB. Ù‚Ù„Ù‘Ù„ Ø¹Ø¯Ø¯/Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±.', 'warn');
    return;
  }

  // 2) Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­ØµÙ‘Ø© (Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·ØŒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³Ù…ÙˆØ­ Ø¯Ø§Ø¦Ù…Ø§Ù‹)
  if (!_quotaReady){
    toast('Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø§Øªâ€¦ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­ØµÙ‘Ø©', 'warn');
    return;
  }

  const fd = new FormData(landForm);

  // âœ… Ø§Ù„Ø³Ø¹Ø± Ø¥Ø¬Ø¨Ø§Ø±ÙŠ (> 0)
  const rawPrice = (fd.get('price') || '').toString().trim();
  const priceNum = Number(rawPrice);

  if (!rawPrice || !Number.isFinite(priceNum) || priceNum <= 0){
    toast('Ø§Ù„Ø³Ø¹Ø± Ø¥Ø¬Ø¨Ø§Ø±ÙŠ â€” Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±', 'warn');
    return;
  }

  // âœ… ÙŠØ¬Ø¨ ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
  if (!pendingPhotos || pendingPhotos.length === 0){
    toast('ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸', 'warn');
    return;
  }

  const idForEdit = (fd.get('id') || '').toString().trim();
  const isEdit    = !!idForEdit;

  // â›”ï¸ Ù„Ùˆ Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ø®Ø·Ù‘Ø© ÙˆØµÙ„Øª Ø§Ù„Ø­Ø¯ â€” Ø§Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  if (!isEdit) {
    const left      = _quotaState?.left;
    const unlimited = _quotaState?.unlimited === true || left === Infinity;
    if (!unlimited && Number(left) <= 0) {
      toast('Ø¨Ù„ØºØª Ø­Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ÙÙŠ Ø®Ø·ØªÙƒ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„Ù„Ù†Ø´Ø± Ø£ÙƒØ«Ø±.', 'warn');
      return;
    }
  }

  // ÙØ­Øµ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  const wa = (fd.get('ownerWhatsapp')||'').toString().trim().replace(/\s+/g,'');
  if (wa && !/^\+?\d{6,15}$/.test(wa)){
    toast('Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­','warn');
    return;
  }

  const lat = parseFloat(fd.get('lat'));
  const lng = parseFloat(fd.get('lng'));

  const payload = {
    ownerFirst:    (fd.get('ownerFirst')    || '').toString().trim(),
    ownerLast:     (fd.get('ownerLast')     || '').toString().trim(),
    ownerWhatsapp: (fd.get('ownerWhatsapp') || '').toString().trim(),
    title:         (fd.get('title')         || '').toString().trim(),
    kind:          fd.get('kind') || 'sale',
    area:          (fd.get('area') || '').toString().trim(),
    city:          (fd.get('city') || '').toString().trim(),
    size:          parseInt(fd.get('size') || 0,10),
    price:         priceNum,
    currency:      (fd.get('currency') === 'SYP' ? 'SYP' : 'USD'),
    rentPeriod:    (fd.get('rentPeriod') || '').toString(),
    photos:        [...pendingPhotos], // Ù…Ø²ÙŠØ¬ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· Ù‚Ø¯ÙŠÙ…Ø© + ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©
    poolDesc:      (fd.get('poolDesc')      || '').toString().trim(),
    amenitiesDesc: (fd.get('amenitiesDesc') || '').toString().trim(),
    buildingDesc:  (fd.get('buildingDesc')  || '').toString().trim(),
    description:   (fd.get('desc')          || '').toString().trim(),
    videoUrl:      (fd.get('videoUrl')      || '').toString().trim(),
    location: (Number.isFinite(lat)&&Number.isFinite(lng))
      ? {lat,lng,address:(fd.get('address')||'').toString()}
      : null
  };

  const url    = isEdit ? `/owner/lands/${idForEdit}` : '/owner/lands';
  const method = isEdit ? 'PATCH' : 'POST';

  // ğŸ‘ˆ Ù…Ù† Ù‡Ù†Ø§ ÙŠØ¨Ø¯Ø£ "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„" ÙØ¹Ù„ÙŠØ§Ù‹
  isLandSubmitting = true;
  submitBtnPrimary.disabled = true;
  submitBtnPrimary.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦';

  try{
    const res  = await fetch(url, {
      method,
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload),
    });

    let data;
    try {
      data = await res.json();
    } catch {
      data = { ok:false, msg:'Ø±Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…' };
    }

    if (!data.ok){
      toast(data.msg || 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'warn');
      return;
    }

    toast(isEdit ? 'ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©','ok');

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„ÙˆØ¶Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
    const ft2 = document.getElementById('formTitle');
    if (ft2) ft2.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø£Ø±Ø¶';

    landForm.querySelector('[name="id"]').value = '';
    landForm.reset();
    pendingPhotos = [];
    renderThumbs?.();
    marker?.setOpacity?.(0);

    // Ø­Ø¯Ù‘Ø« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø­ØµÙ‘Ø©
    await renderLands();
    await refreshQuota?.();

  }catch(err){
    console.error(err);
    toast('Ø®Ø·Ø£ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…','warn');
  }finally{
    isLandSubmitting = false;
    submitBtnPrimary.disabled = false;
    submitBtnPrimary.textContent = defaultLandLabel;
  }
});


      // ====== Ø·Ù„Ø¨ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ======
      // Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ§Ù„ÙŠØ© Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù…Ùƒ
      const ADMIN_WA_PREMIUM = '+21620353915'; // Ø±Ù‚Ù… Ø¥Ø¯Ø§Ø±Ø© Premium
      const ADMIN_WA_VIP     = '+21620353915'; // Ø±Ù‚Ù… Ø¥Ø¯Ø§Ø±Ø© VIP

      function isValidWa(num){
        const n = (num||'').toString().trim().replace(/\s+/g,'');
        return /^\+?\d{6,15}$/.test(n);
      }

     function prefillSubscribe(){
   const f = document.getElementById('subscribeForm');
   if (!f) return;
   try{
     // Ø¬Ø±Ù‘Ø¨ Ø¢Ø®Ø± Ø¥Ø¹Ù„Ø§Ù† Ø­Ù‚ÙŠÙ‚ÙŠ Ø¬Ù„Ø¨Ù†Ø§Ù‡ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
     const src = (window.__myLands || []).find(x => x?.ownerInfo) || null;
     const o   = src?.ownerInfo || {};
     if (!f.ownerFirst.value)    f.ownerFirst.value    = o.first    || '';
     if (!f.ownerLast.value)     f.ownerLast.value     = o.last     || '';
     if (!f.ownerWhatsapp.value) f.ownerWhatsapp.value = o.whatsapp || '';
   }catch{}
   if (!f.plan.value) f.plan.value = 'Premium';
 }
      function makeWaLink({to, text}){
        const num = to.replace(/\D/g,'');
        return `https://wa.me/${num}?text=${encodeURIComponent(text)}`;
      }

      const subscribeForm = document.getElementById('subscribeForm');
      const prefillBtn    = document.getElementById('prefillBtn');

      if (prefillBtn) prefillBtn.addEventListener('click', prefillSubscribe);

      if (subscribeForm){
        subscribeForm.addEventListener('submit',async (e)=>{
          e.preventDefault();
          const fd = new FormData(subscribeForm);
          const plan   = fd.get('plan') || 'Premium';
          const first  = (fd.get('ownerFirst')||'').toString().trim();
          const last   = (fd.get('ownerLast')||'').toString().trim();
          const wa     = (fd.get('ownerWhatsapp')||'').toString().trim();
          const notes  = (fd.get('notes')||'').toString().trim();

          if (!first || !last){ toast('Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨', 'warn'); return; }
          if (!isValidWa(wa)){ toast('Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­', 'warn'); return; }

          const adminTo = (plan === 'VIP') ? ADMIN_WA_VIP : ADMIN_WA_PREMIUM;

          const msg = [
            'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¥Ø¯Ø§Ø±Ø© Farmers ğŸ‘‹',
            `Ø£Ø±ØºØ¨ Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: ${plan}`,
            `Ø§Ù„Ø§Ø³Ù…: ${first} ${last}`,
            `ÙˆØ§ØªØ³Ø§Ø¨ÙŠ: ${wa}`,
            notes? `Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes}` : null,
            'Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ….'
          ].filter(Boolean).join('\n');
          // Ø¨Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ msg Ùˆ adminTo:
try {
  const payload = {
    plan,
    ownerFirst: first,
    ownerLast:  last,
    ownerWhatsapp: wa,
    notes
  };
  await fetch('/owner/subscriptions', {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify(payload)
  });
  // Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ Ù„Ù† Ù†Ù…Ù†Ø¹ ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø¨Ø³ Ø¨Ù†Ø·Ù„Ø¹ Toast
} catch (e) {
  console.warn('Subscription save error:', e);
  toast('Ù„Ù… Ù†Ø³ØªØ·Ø¹ Ø­ÙØ¸ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ù„ÙƒÙ† Ø³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨', 'warn');
}

          const url = makeWaLink({to: adminTo, text: msg});
          window.open(url, '_blank', 'noopener');
          toast('ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'ok');
        });
      }

      // Ù„ØºØ©/Ø§ØªØ¬Ø§Ù‡
      qs('#langToggle').addEventListener('click', ()=>{
        const rtl = document.documentElement.getAttribute('dir')==='rtl';
        document.documentElement.setAttribute('dir', rtl?'ltr':'rtl');
        qs('#langToggle').textContent = rtl ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English';
        setTimeout(()=> map.invalidateSize(), 100);
      });

 // === Ø§Ù„Ø­ØµØ© ÙˆØ­Ø¯ÙˆØ¯ Ø§Ù„Ù†Ø´Ø± ===
async function refreshQuota(){
  const submitBtn = document.querySelector('#landForm button[type="submit"]');

  // Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: Ù†Ù†Ø´Ø¦ ØµÙ†Ø¯ÙˆÙ‚ ØµØºÙŠØ± Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±Ù… Ø¥Ø°Ø§ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
  let info = document.getElementById('quotaMsg');
  if (!info) {
    info = document.createElement('div');
    info.id = 'quotaMsg';
    info.style.margin = '0 0 .75rem 0';
    info.style.fontSize = '.95rem';
    const form = document.getElementById('landForm');
    if (form) form.parentNode.insertBefore(info, form); // Ø¶Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆÙ‚ Ø§Ù„ÙÙˆØ±Ù…
  }

  info.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­ØµØªÙƒâ€¦';

  try{
  const r = await fetch('/owner/lands/quota', { headers:{'Accept':'application/json'} });
  const j = await r.json();
  if (!j.ok) throw new Error(j.msg || 'quota error');

  // âœ… Ø®Ø²Ù‘Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ù„ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ù€ submit
  const { plan, limit, used, left } = j.data;
  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¶ Ø§Ù„Ù€ APIs ØªØ±Ø¬Ù‘Ø¹ null Ø¹ÙˆØ¶ Infinity. Ù†Ø¹ØªØ¨Ø± null = ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯
  const unlimited = (left === null || limit === null);
  const leftNum   = unlimited ? Infinity : Number(left);
  const limitNum  = unlimited ? Infinity : Number(limit);

  _quotaState = { plan, left: leftNum, unlimited };

  const limitTxt = unlimited ? 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯' : limitNum;
  const leftTxt  = unlimited ? 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯' : leftNum;

  info.innerHTML = `
    <span style="padding:.25rem .5rem;border:1px solid #e5e7eb;border-radius:999px;background:#f9fafb">
      Ø®Ø·ØªÙƒ: <strong>${plan}</strong> â€¢ Ø§Ù„Ù…Ø³Ù…ÙˆØ­: <strong>${limitTxt}</strong> â€¢ Ø§Ù„Ù…ÙØ³ØªØ®Ø¯Ù…: <strong>${used}</strong> â€¢ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <strong>${leftTxt}</strong>
    </span>
  `;
_quotaReady = true;
  if (submitBtn) {
    if (!unlimited && leftNum <= 0) {
      submitBtn.disabled = true;
      submitBtn.title = 'Ø¨Ù„ØºØªÙ Ø­Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ÙÙŠ Ø®Ø·ØªÙƒ';
    } else {
      submitBtn.disabled = false;
      submitBtn.title = '';
    }
  }

}catch(e){
  console.warn(e);
  info.innerHTML = `<span class="muted">ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­ØµÙ‘Ø©.</span>`;
    // ÙÙŠ catch:
_quotaReady = false;
if (submitBtn) {
  submitBtn.disabled = true;
  submitBtn.title = 'ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­ØµÙ‘Ø©';
}
}

}

// Ù†Ø§Ø¯ÙÙ‡Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
refreshQuota();

    })();
  </script>
 
</body>
</html>
