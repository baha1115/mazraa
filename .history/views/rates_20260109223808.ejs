<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</title>

  <style>
    :root{
      --bg:#efe9dc;
      --card:#ffffff;
      --accent:#0b4e45;
      --accent2:#1aa37a;
      --muted:#6b7280;
      --soft:#f6f7f8;
      --soft2:#f2efe7;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --shadow2: 0 6px 18px rgba(0,0,0,.06);
      --radius:18px;
      --radius2:14px;
      --border:1px solid rgba(0,0,0,.08);
    }

    *,*::before,*::after{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Kufi Arabic", "Noto Sans Arabic", sans-serif;
      background: var(--bg);
      color:#111827;
      overflow-x:hidden;
    }

    header{
      background: linear-gradient(180deg, #0b4e45 0%, #0f5b4f 100%);
      color:#fff;
      padding: 18px 14px 14px;
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
      font-weight:1000;
    }
    header p{
      margin:8px 0 0;
      opacity:.92;
      font-size:13px;
      font-weight:700;
    }

    .wrap{
      max-width: 980px;
      margin: 16px auto;
      padding: 0 14px 28px;
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      border: 1px solid rgba(0,0,0,.06);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }

    .back{
      text-decoration:none;
      font-weight:900;
      background:#fff;
      border: var(--border);
      padding:9px 12px;
      border-radius:12px;
      color: var(--accent);
      box-shadow: var(--shadow2);
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    .api-pill{
      font-size:12px;
      font-weight:900;
      padding:8px 12px;
      border-radius:999px;
      background: #e9f3f1;
      border: 1px solid rgba(11,78,69,.18);
      color: var(--accent);
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media(min-width:860px){
      .grid.two{ grid-template-columns: 1fr 1fr; }
      .grid.three{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .section-title{
      margin:0;
      font-size: 15px;
      font-weight:1000;
      color:#0b4e45;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .hint{
      margin-top:8px;
      font-size:12px;
      color: var(--muted);
      font-weight:800;
      line-height:1.6;
    }

    .input{
      display:flex;
      align-items:center;
      gap:10px;
      background: var(--soft2);
      border-radius: var(--radius2);
      padding: 12px 14px;
      border: 1px solid rgba(0,0,0,.08);
    }
    .input input{
      border:0;
      outline:0;
      background:transparent;
      width:100%;
      font-size: 20px;
      font-weight:1000;
      color: var(--accent);
    }
    .input input::placeholder{ opacity:.55; font-weight:900; }

    .badge{
      font-size: 12px;
      background: #e9f3f1;
      border:1px solid rgba(11,78,69,.18);
      color: var(--accent);
      padding:6px 10px;
      border-radius: 999px;
      white-space:nowrap;
      font-weight:1000;
    }

    .tabs{
      display:flex;
      background: var(--soft2);
      border-radius: var(--radius2);
      padding: 6px;
      gap: 6px;
      border: 1px solid rgba(0,0,0,.08);
    }
    .tab{
      flex:1;
      padding: 10px 8px;
      border-radius: 12px;
      border:0;
      background: transparent;
      cursor:pointer;
      font-weight:1000;
      color:#334155;
      font-size:14px;
    }
    .tab.active{
      background:#ffffff;
      color: var(--accent);
      box-shadow: 0 4px 14px rgba(0,0,0,.08);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      border:0;
      cursor:pointer;
      font-weight:1000;
      border-radius: 14px;
      padding: 12px 14px;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      min-height:44px;
    }
    .btn.primary{
      background: var(--accent);
      color:#fff;
      box-shadow: var(--shadow2);
    }
    .btn.ghost{
      background:#fff;
      color: var(--accent);
      border: var(--border);
    }

    .stat{
      background: var(--soft);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 16px;
      padding: 14px;
      min-height: 90px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .stat.green{
      background: #dff6ea;
      border-color: rgba(26,163,122,.35);
    }
    .stat .k{
      color: var(--muted);
      font-size:12px;
      font-weight:900;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .stat .v{
      font-size:24px;
      font-weight:1100;
      margin-top:6px;
      letter-spacing:.2px;
    }
    .stat .v small{
      font-size:14px;
      font-weight:900;
      color:#111827;
      opacity:.85;
    }

    .divider{
      height:1px;
      background:rgba(0,0,0,.08);
      margin: 8px 0 2px;
      border-radius:999px;
    }

    .note{
      text-align:center;
      margin-top:10px;
      color: var(--muted);
      font-size:12px;
      font-weight:900;
      line-height:1.6;
    }

    /* Mobile */
    @media (max-width: 480px){
      header{ padding:14px 12px 12px; }
      header h1{ font-size:18px; }
      header p{ font-size:12px; }
      .wrap{ margin:10px auto; padding:0 10px 18px; }
      .card{ padding:12px; }
      .topbar{ flex-direction: column; align-items: stretch; }
      .back{ width:100%; justify-content:center; }
      .api-pill{ width:100%; text-align:center; }
      .tab{ padding:8px 6px; font-size:13px; }
      .input{ padding:10px 12px; gap:8px; }
      .input input{ font-size:18px; }
      .badge{ font-size:12px; padding:5px 8px; }
      .actions{ flex-direction: column; }
      .btn{ width:100%; }
      .stat .v{ font-size:22px; }
    }
  </style>
</head>

<body>
  <header>
    <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h1>
    <p>Ø£Ø¯Ø®Ù„ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±/Ø§Ù„ÙŠÙˆØ±Ùˆ/Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„ØªØ±ÙƒÙŠØ© Ø£Ùˆ Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© â€” ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙˆØ±Ø§Ù‹.</p>
  </header>

  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <a class="back" href="/">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <div class="api-pill" id="apiStatus">Ø¬Ø§Ù‡Ø²</div>
      </div>

      <div class="grid two">
        <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© -->
        <div>
          <div class="section-title">ğŸ’± Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø©</div>
          <div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø«Ù… Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº (Ù…Ø«Ù„Ø§Ù‹: 100 USD) Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…ØªÙ‡ Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù‚Ø¯ÙŠÙ…Ø©.</div>

          <div style="margin-top:10px">
            <div class="tabs" role="tablist" aria-label="Currencies">
              <button class="tab" data-cur="TRY" type="button">TRY</button>
              <button class="tab" data-cur="EUR" type="button">EUR</button>
              <button class="tab active" data-cur="USD" type="button">USD</button>
            </div>
          </div>

          <div style="margin-top:10px">
            <div class="input">
              <span class="badge" id="curLabel">USD</span>
              <input id="curAmount" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 100" value="" />
              <span class="badge" id="curSym">$</span>
            </div>
          </div>

          <div class="hint">
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ«Ù‡ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹.
          </div>
        </div>

        <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© -->
        <div>
          <div class="section-title">ğŸ§¾ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</div>
          <div class="hint">Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºØ§Ù‹ Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© + Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>

          <div style="margin-top:10px">
            <div class="input">
              <span class="badge">Ù„.Ø³ Ù‚Ø¯ÙŠÙ…</span>
              <input id="oldAmount" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 895000" value="895000" />
            </div>
          </div>

          <div class="hint">
            Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø¶Ø¨ÙˆØ· Ø¹Ù„Ù‰: <b id="factorLabel">100</b> (100 Ù‚Ø¯ÙŠÙ… = 1 Ø¬Ø¯ÙŠØ¯)
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù -->
      <div style="margin-top:10px">
        <div class="section-title">ğŸ“Œ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</div>
        <div class="hint">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹  Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¹Ø± ÙŠØ¯ÙˆÙŠØ§Ù‹.</div>

        <div style="margin-top:10px">
          <div class="input">
            <span class="badge" id="rateLabel">USD</span>
            <input id="rate" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 11800" value="11800" />
            <span class="badge">Ù„.Ø³ Ø¬Ø¯ÙŠØ¯ / 1</span>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="fetchRateBtn" type="button">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±</button>
          <button class="btn ghost" id="swapBtn" type="button">â†”ï¸ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</button>
        </div>
      </div>

      <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <div class="grid three" style="margin-top:12px;">
        <div class="stat green">
          <div class="k">âœ… Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
          <div class="v" id="outNewSyp">0 <small>Ù„.Ø³</small></div>
        </div>

        <div class="stat">
          <div class="k">ğŸ•˜ Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</div>
          <div class="v" id="outOldSyp">0 <small>Ù„.Ø³</small></div>
        </div>

        <div class="stat">
          <div class="k">ğŸ’± Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</div>
          <div class="v" id="outCur">0.00 $</div>
        </div>
      </div>

      <div class="note">
        Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆØªØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆÙ‚. Ù…ØµØ¯Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«
      </div>
    </div>
  </div>

<script>
(() => {
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  const CONVERSION_FACTOR = 100; // 100 Ù‚Ø¯ÙŠÙ… = 1 Ø¬Ø¯ÙŠØ¯

  // API Ù…Ø¬Ø§Ù†ÙŠ (Open Access)
  const API_URL = (base) => `https://open.er-api.com/v6/latest/${base}`;

  const $ = (id) => document.getElementById(id);

  const state = {
    currency: 'USD',
    rateSypPer1: 11800,       // Ù„.Ø³ Ø¬Ø¯ÙŠØ¯ Ù„ÙƒÙ„ 1 Ø¹Ù…Ù„Ø©
    lastEdited: 'old',        // 'old' Ø£Ùˆ 'cur'
    lastUpdateUtc: null
  };

  function symOf(cur){
    return cur === 'USD' ? '$' : (cur === 'EUR' ? 'â‚¬' : 'â‚º');
  }

  function toNumber(v, allowDecimal){
    v = String(v ?? '');
    v = allowDecimal ? v.replace(/[^\d.]/g,'') : v.replace(/[^\d]/g,'');
    const n = Number(v);
    return Number.isFinite(n) ? n : 0;
  }

  function fmtInt(n){
    n = Math.round(Number(n || 0));
    return n.toLocaleString('en-US');
  }

  function fmt(n, digits=2){
    n = Number(n || 0);
    return n.toLocaleString('en-US', { minimumFractionDigits: digits, maximumFractionDigits: digits });
  }

  function updateUiLabels(){
    $('curLabel').textContent = state.currency;
    $('rateLabel').textContent = state.currency;
    $('curSym').textContent = symOf(state.currency);

    document.querySelectorAll('.tab').forEach(b => {
      b.classList.toggle('active', b.dataset.cur === state.currency);
    });
  }

  function recalc(){
    const rate = toNumber($('rate').value, true);
    state.rateSypPer1 = rate;

    let oldSyp = 0;  // Ù„.Ø³ Ù‚Ø¯ÙŠÙ…
    let newSyp = 0;  // Ù„.Ø³ Ø¬Ø¯ÙŠØ¯
    let curAmt = 0;  // USD/EUR/TRY

    if (state.lastEdited === 'cur') {
      // Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© -> Ø§Ø­Ø³Ø¨ Ø¬Ø¯ÙŠØ¯ Ø«Ù… Ù‚Ø¯ÙŠÙ…
      curAmt = toNumber($('curAmount').value, true);
      newSyp = curAmt * rate;
      oldSyp = newSyp * CONVERSION_FACTOR;

      // Ø­Ø¯Ø« Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¢Ø®Ø± (Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø°ÙŠ ÙŠÙƒØªØ¨ ÙÙŠÙ‡ Ø§Ù„Ø¢Ù†)
      $('oldAmount').value = oldSyp ? fmtInt(oldSyp) : '';
    } else {
      // Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ… -> Ø§Ø­Ø³Ø¨ Ø¬Ø¯ÙŠØ¯ Ø«Ù… Ø§Ù„Ø¹Ù…Ù„Ø©
      oldSyp = toNumber($('oldAmount').value, false);
      newSyp = oldSyp / CONVERSION_FACTOR;
      curAmt = (rate > 0) ? (newSyp / rate) : 0;

      $('curAmount').value = curAmt ? fmt(curAmt, 2) : '';
    }

    // Outputs
    $('outNewSyp').innerHTML = `${fmtInt(newSyp)} <small>Ù„.Ø³</small>`;
    $('outOldSyp').innerHTML = `${fmtInt(oldSyp)} <small>Ù„.Ø³</small>`;
    $('outCur').textContent  = `${fmt(curAmt, 2)} ${symOf(state.currency)}`;
  }

  function loadRateCache(){
    try{
      const raw = localStorage.getItem(`rate_${state.currency}_SYP_cache_v1`);
      if (!raw) return false;
      const c = JSON.parse(raw);
      if (!c || !c.ts || !c.rate) return false;
      // 6 Ø³Ø§Ø¹Ø§Øª
      if (Date.now() - c.ts > 6*60*60*1000) return false;
      $('rate').value = String(c.rate);
      if (c.utc) $('apiStatus').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${c.utc} (ÙƒØ§Ø´)`;
      return true;
    }catch(_){ return false; }
  }

  function saveRateCache(rate, utc){
    try{
      localStorage.setItem(`rate_${state.currency}_SYP_cache_v1`, JSON.stringify({
        ts: Date.now(),
        rate,
        utc: utc || null
      }));
    }catch(_){}
  }

  async function fetchRate(){
    const apiStatus = $('apiStatus');
    apiStatus.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±...';

    try {
      const res = await fetch(API_URL(state.currency), { headers: { 'Accept': 'application/json' }});
      const json = await res.json();

      if (!res.ok || json.result !== 'success' || !json.rates || !json.rates.SYP){
        throw new Error('bad_api');
      }

      const rate = Number(json.rates.SYP);
      $('rate').value = String(rate);

      state.lastUpdateUtc = json.time_last_update_utc || null;
      apiStatus.textContent = state.lastUpdateUtc ? `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${state.lastUpdateUtc}` : 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± âœ…';

      saveRateCache(rate, state.lastUpdateUtc);
      recalc();
    } catch (e) {
      console.error(e);
      apiStatus.textContent = 'ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± (Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ) âŒ';
    }
  }

  function setCurrency(cur){
    state.currency = cur;
    updateUiLabels();

    // Ø­Ø§ÙˆÙ„ ÙƒØ§Ø´ Ø£ÙˆÙ„Ø§Ù‹
    const ok = loadRateCache();
    if (!ok){
      // Ù„Ùˆ Ø¹Ù†Ø¯Ù†Ø§ ØªØ®Ø²ÙŠÙ† Ù‚Ø¯ÙŠÙ… Ø¨Ø³ÙŠØ· (Ù…Ù† Ù†Ø³Ø® Ø³Ø§Ø¨Ù‚Ø©)
      const legacy = localStorage.getItem(`rate_${cur}_SYP`);
      if (legacy) $('rate').value = legacy;
    }

    recalc();
  }

  // Events
  document.querySelector('.tabs')?.addEventListener('click', (e) => {
    const btn = e.target.closest('.tab');
    if (!btn) return;
    setCurrency(btn.dataset.cur);
  });

  $('curAmount')?.addEventListener('input', () => { state.lastEdited = 'cur'; recalc(); });
  $('oldAmount')?.addEventListener('input', () => { state.lastEdited = 'old'; recalc(); });
  $('rate')?.addEventListener('input', () => { recalc(); });

  $('fetchRateBtn')?.addEventListener('click', fetchRate);

  $('swapBtn')?.addEventListener('click', () => {
    // ØªØ¨Ø§Ø¯Ù„ Ù…Ù†Ø·Ù‚ÙŠ: Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙƒØªØ¨ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© ØµØ§Ø± ÙŠÙƒØªØ¨ Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¹ÙƒØ³
    state.lastEdited = (state.lastEdited === 'cur') ? 'old' : 'cur';
    recalc();
  });

  // init
  $('factorLabel').textContent = CONVERSION_FACTOR;
  updateUiLabels();

  // Ø§Ø³ØªØ¹Ù…Ù„ ÙƒØ§Ø´ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ Ø«Ù… Ø§Ø­Ø³Ø¨
  loadRateCache();
  recalc();
})();
</script>

</body>
</html>
